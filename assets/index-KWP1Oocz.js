import{m as oe,j as t,A as St,T as yt,B as M,S as Be,a as Ve,b as F,E as Ct,c as bt,r as h,d as be,I as we,L as wt,D as pe,e as fe,f as se,g as Ie,l as Ue,F as Qe,h as ge,i as et,k as me,n as De,C as jt,o as J,U as vt,p as tt,q as It,s as kt,t as Tt,u as nt,v as b,w as We,x as Ft,y as Nt,z as Ht,G as Dt,H as st,J as $t,K as je,M as Se,N as ot,O as Et,P as Ot,Q as it,R as ke,V as Rt,W as Te,X as Lt,Y as Wt,Z as _,_ as Je,$ as ze,a0 as Gt,a1 as Fe,a2 as _e,a3 as qe,a4 as Xe,a5 as At,a6 as Mt,a7 as Ye,a8 as Pt,a9 as Bt,aa as Vt,ab as Ut,ac as Ne,ad as Jt,ae as zt,af as _t}from"./vendor-a6uATVjr.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function s(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(r){if(r.ep)return;r.ep=!0;const l=s(r);fetch(r.href,l)}})();async function qt(e){return fetch("https://api-ssl.bitly.com/v4/shorten",{method:"POST",body:JSON.stringify({long_url:e}),headers:{Authorization:"b001e5ac78566bce29e6bb5ad43e0782a10632a7","Content-Type":"application/json"}}).then(n=>n.json()).then(n=>({link:n.link,errorNeeded:!1})).catch(()=>({link:void 0,errorNeeded:!0}))}async function Xt(e){const n=`bit.ly/${e.text}`;return fetch("https://api-ssl.bitly.com/v4/expand",{method:"POST",body:JSON.stringify({bitlink_id:n}),headers:{Authorization:"b001e5ac78566bce29e6bb5ad43e0782a10632a7","Content-Type":"application/json"}}).then(s=>s.json()).catch(s=>console.error(s))}const Yt="/FSHOnline/assets/FSH-online-logo-BTt1RVAN.png",Kt=oe(e=>({root:{background:e.palette.common.blue,position:"static",boxShadow:"0"},title:{fontSize:20,fontWeight:700},logo:{height:"55px",width:"63px"},toolbarBox:{alignItems:"center"},exitIcon:{paddingLeft:"3px",transform:"scaleX(-1)"},docButton:{color:e.palette.common.white,backgroundColor:e.palette.common.blue,fontSize:"0.875rem",fontWeight:700,"&:hover":{background:e.palette.common.lightBlue}},versionText:{color:e.palette.common.white,fontSize:"0.8rem",fontStyle:"italic",marginTop:"-5px"}}));function Zt(){const e=Kt();return t.jsx(St,{className:e.root,children:t.jsx(yt,{children:t.jsxs(M,{className:e.toolbarBox,display:"flex",flexGrow:1,flexDirection:"row",children:[t.jsxs(M,{order:1,display:"flex",flexGrow:1,flexDirection:"row",children:[t.jsx(M,{order:1,alignSelf:"center",display:"flex",children:t.jsx("img",{src:Yt,alt:"logo",className:e.logo})}),t.jsx(M,{order:2,alignSelf:"center",m:1,children:t.jsxs(Be,{injectFirst:!0,children:[t.jsx(Ve,{order:1,className:e.title,children:"FSH ONLINE"}),t.jsx(Ve,{order:2,className:e.versionText,children:"Powered by SUSHI v3.11.0 and GoFSH v2.3.1"})]})})]}),t.jsx(M,{order:1,children:t.jsx(Be,{injectFirst:!0,children:t.jsxs(F,{className:e.docButton,href:"https://fshschool.org/",target:"_blank",children:[t.jsx(Ct,{className:e.exitIcon,fontSize:"small"}),"Back to School"]})})})]})})})}const te={lighterBlue:"#D8E2EA",lightBlue:"#487AA2",blue:"#30638e",darkerBlue:"#143E61",editorGrey:"#263238",lightestGrey:"#E7ECEE",lightGrey:"#D0D9DD",grey:"#575B5C",darkerGrey:"#3D4345",darkestGrey:"#121D21",red:"#FD6668"},Ge=bt({palette:{success:{main:te.blue,dark:te.darkerBlue,light:te.lightBlue},common:te},typography:{fontFamily:"Open Sans"},overrides:{MuiTooltip:{tooltip:{backgroundColor:te.darkestGrey,fontSize:"13px"},arrow:{color:te.darkestGrey}},MuiButton:{text:{textTransform:"none",fontWeight:600}},MuiIconButton:{root:{"&:hover":{backgroundColor:te.grey}}}}}),Qt=oe(e=>({iconButton:{color:e.palette.common.white,padding:"3px"},textArea:{width:"100%",color:e.palette.text.primary,fontWeight:"bold"},copyBox:{backgroundColor:e.palette.common.lightGrey,borderRadius:2,display:"flex",justifyContent:"space-between",alignItems:"center",paddingLeft:"3%",textOverflow:"ellipsis"}}));function en(e){const n=Qt(),[s,o]=h.useState(!1),[r,l]=h.useState(!1),[c,a]=h.useState(!1),[i,d]=h.useState(!1),[u,f]=h.useState("Copy to Clipboard"),[{fshCopied:C,fshCopyButton:w},m]=h.useState({fshCopied:!1,fshCopyButton:"Copy FSH to Clipboard"}),[k,$]=h.useState(),[z,Y]=h.useState(),[K,Z]=h.useState(!0),V=H=>{var q;const W=(q=H.target.value.match(/gist\.github\.com\/[^/]+\/(.+)/))==null?void 0:q[1];W&&Y(`https://fshschool.org/FSHOnline/#/gist/${W}`)},U=()=>{l(!0),O()},O=()=>{o(!1),a(!0),Y(""),m({fshCopied:!1,fshCopyButton:"Copy FSH to Clipboard"})},L=()=>{a(!1),l(!1)},S=()=>{z?(L(),$(z),o(!0),f("Copy to Clipboard"),Z(!1)):d(!0)},y=()=>{d(!1)},x=async()=>{var ie,re,ae,le,ce,de,Q,ue;let H;(ie=e.config)!=null&&ie.canonical||(re=e.config)!=null&&re.version||((ae=e.config)==null?void 0:ae.fhirVersion.length)>0||(le=e.config)!=null&&le.dependencies?H=De.deflateSync(JSON.stringify({c:(ce=e.config)==null?void 0:ce.canonical,v:(de=e.config)==null?void 0:de.version,f:(Q=e.config)==null?void 0:Q.fhirVersion,d:(ue=e.config)==null?void 0:ue.dependencies})+`
`+e.shareText).toString("base64"):H=De.deflateSync(e.shareText).toString("base64");const W=`https://fshschool.org/FSHOnline/#/share/${H}`,q=await qt(W);if(q.errorNeeded===!0)U();else{const he=`https://fshschool.org/FSHOnline/#/share/${q.link.slice(15)}`;$(he),o(!0),f("Copy to Clipboard"),Z(!0)}},j=()=>{o(!1),l(!1)},T=()=>{m({fshCopied:!0,fshCopyButton:"FSH Copied to Clipboard"})};return t.jsxs(t.Fragment,{children:[t.jsx(be,{title:"Share FSH",placement:"top",arrow:!0,children:t.jsx(we,{name:"Share FSH",className:n.iconButton,onClick:x,children:t.jsx(wt,{fontSize:"small",style:{transform:"rotate(-45deg)"}})})}),t.jsxs(pe,{open:s,onClose:j,"aria-labelledby":"form-dialog-title",maxWidth:"md",fullWidth:!0,children:[t.jsx(fe,{id:"form-dialog-title",children:"Share"}),t.jsxs(se,{children:[t.jsx(Ie,{children:"Use this link to share your FSH with others!"}),t.jsxs(M,{className:n.copyBox,children:[t.jsx(M,{maxWidth:"90%",textOverflow:"ellipsis",overflow:"hidden",children:k}),t.jsx(be,{title:u,placement:"top",arrow:!0,children:t.jsx(Ue.CopyToClipboard,{text:k,onCopy:()=>f("Link Copied"),children:t.jsx(we,{style:{borderRadius:"0%"},children:t.jsx(Qe,{})})})})]})]}),t.jsxs(ge,{children:[K&&t.jsx(F,{onClick:O,color:"primary",style:{align:"left"},children:"Create Link with Gist"}),t.jsx(M,{style:{flex:"1 0 0",hidden:!0}}),t.jsx(F,{onClick:j,color:"primary",children:"Done"})]})]}),t.jsxs(pe,{open:c,onClose:L,"aria-labelledby":"alert-dialog-title",maxWidth:"md",fullWidth:!0,children:[t.jsx(fe,{id:"alert-dialog-title",children:"Share with Gist"}),r&&t.jsx(se,{style:{color:Ge.palette.common.red},children:"Your FSH content is too long to share directly. Please use a Gist to share."}),t.jsxs(se,{children:["Create a"," ",t.jsx(et,{id:"gistURL",href:"https://gist.github.com/",target:"_blank",children:"Gist"})," ","and paste the URL below to generate a shareable FSH Online link.",t.jsx(me,{id:"gistURLText",label:"Gist URL",fullWidth:!0,onChange:V})]}),t.jsxs(ge,{style:{bottom:0,right:0},children:[t.jsx(F,{onClick:L,color:"primary",children:"Cancel"}),t.jsx(M,{style:{flex:"1 0 0",hidden:!0}}),t.jsx(Ue.CopyToClipboard,{text:e.shareText,onCopy:T,style:{align:"left"},children:t.jsx(F,{color:C?"secondary":"primary",children:w})}),t.jsx(F,{color:"primary",onClick:S,style:{align:"left"},children:"Generate Link from Gist"})]})]}),t.jsxs(pe,{open:i,onClose:y,"aria-labelledby":"alert-dialog-title",maxWidth:"lg",children:[t.jsx(fe,{id:"alert-dialog-title",children:"Error Creating Gist Link"}),t.jsx(se,{children:t.jsx(Ie,{children:"Could not generate a link from your Gist URL. Ensure the URL is valid."})}),t.jsx(ge,{children:t.jsx(F,{onClick:y,color:"primary",children:"Keep Swimming!"})})]})]})}jt.defineSimpleMode("fsh",{meta:{lineComment:"//"},start:[{regex:/"(?:[^\\]|\\.)*?(?:"|$)/,token:"atom"},{regex:/\b(Alias|Characteristics|Context|CodeSystem|Expression|Extension|Description|Id|Instance|InstanceOf|Invariant|Logical|Mapping|Mixins|Parent|Profile|Resource|RuleSet|Severity|Source|Target|Title|Usage|ValueSet|XPath)(?=\s*:)\b/,token:"keyword"},{regex:/(\s|^)(and|codes|contains|descendent-of|exclude|exists|from system|from|generalizes|include|in|insert|is-a|is-not-a|named|not-in|obeys|only|or|regex|units|valueset|where|D|MS|N|SU|TU|\\?!)(\s|$)/,token:"def"},{regex:/(\(\s*)(exactly|example|extensible|preferred|required)(\s*\))/,token:"def"},{regex:/\b(CodeableReference|Reference|Canonical)\s*\(/,push:"closingParen",token:"atom"},{regex:/\*|->|=|\+|:/,token:"def"},{regex:/\b(https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_+.~#?&//=]*))\b/,token:"atom"},{regex:/(\s|^)(true|false)(\s|$)/,token:"string"},{regex:/(\s|^)(-?\d+(\.\d+)?)(\s|^)/,token:"string"},{regex:/#"(?:\\.|[^\\"])*"/,token:"string"},{regex:/#[^\s]*/,token:"string"},{regex:/'.*'/,token:"string"},{regex:/\s\/\/.*/,token:"comment"},{regex:/\/\/.*/,token:"comment",sol:!0},{regex:/\/\*/,token:"comment",next:"comment"}],closingParen:[{regex:/\)/,pop:!0,token:"atom"}],comment:[{regex:/.*?\*\//,token:"comment",next:"start"},{regex:/.*/,token:"comment"}]});const xe=200,tn=oe(e=>({box:{height:"100%"},header:{fontFamily:"Open Sans",color:e.palette.common.white,background:e.palette.common.darkerGrey,padding:"0px",paddingLeft:"29px",height:"34px",display:"flex",justifyContent:"space-between",transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},headerShift:{width:`calc(100% - ${xe}px - 29px)`,transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginRight:xe},headerLabel:{lineHeight:"34px",float:"left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},headerActionGroup:{paddingRight:"10px"},headerActions:{alignItems:"center",display:"flex"},iconButton:{color:e.palette.common.white,padding:"3px"},drawer:{width:xe,flexShrink:0},drawerPaper:{width:xe,border:"none",height:"calc(100vh - 116px - 34px)",top:"116px"},drawerPaperExpandedConsole:{height:"calc(100vh - 116px - 300px)"},drawerHeader:{display:"flex",alignItems:"center",justifyContent:"flex-start",color:e.palette.common.white,background:e.palette.common.darkerGrey,height:"34px",minHeight:"34px"},drawerHeaderIcon:{padding:"0px",color:e.palette.common.white,background:e.palette.success.main,"&:hover":{background:e.palette.success.light},borderRadius:0,height:"100%",width:"34px",minWidth:"34px"},content:{flexGrow:1,width:"100%",transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},contentShift:{width:`calc(100% - ${xe}px)`,transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginRight:0}}));function Ae(e){const n=tn(),s=h.useContext(xt),[o,r]=h.useState(!0),l=()=>{r(!0)},c=()=>{r(!1)};function a(f){e.updateTextValue(f)}const i=(f,C,w,m={})=>t.jsx(be,{title:b.upperFirst(C),placement:"top",arrow:!0,children:t.jsx(we,{name:C,className:n.iconButton,"aria-label":C,onClick:w,children:t.jsx(f,{fontSize:"small",style:m})})}),d=()=>t.jsxs("div",{className:n.headerActions,children:[t.jsxs("div",{className:n.headerActionGroup,children:[e.mode==="fsh"&&!e.isExamples&&t.jsx(en,{shareText:e.value,config:e.config}),e.copy&&i(Qe,"copy",()=>{}),e.save&&i(tt,"save",e.save),e.delete&&i(It,"delete",e.delete)]}),e.renderDrawer&&!o&&t.jsx(we,{name:"expand",className:n.drawerHeaderIcon,"aria-label":"expand",onClick:l,children:t.jsx(kt,{})})]}),u=()=>t.jsxs(Tt,{className:n.drawer,"data-testid":"editor-drawer",variant:"persistent",anchor:"right",open:o,classes:{paper:J(n.drawerPaper,s&&n.drawerPaperExpandedConsole)},children:[t.jsx("div",{className:n.drawerHeader,children:t.jsx(F,{name:"collapse","aria-label":"collapse",className:n.drawerHeaderIcon,onClick:c,children:t.jsx(nt,{})})}),e.renderDrawer()]});return t.jsxs(M,{className:n.box,children:[t.jsxs("div",{className:J(n.header,{[n.headerShift]:e.renderDrawer&&o}),children:[t.jsx("div",{title:e.name,className:n.headerLabel,children:e.name}),d()]}),t.jsx(vt,{className:J("react-codemirror2",e.renderDrawer&&n.content,{[n.contentShift]:e.renderDrawer&&o}),value:e.initialText,options:{mode:e.mode,theme:"material",placeholder:e.placeholder,scrollbarStyle:"overlay",autoCloseBrackets:!0,lineNumbers:!0,foldGutter:!0,readOnly:e.isExamples,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],extraKeys:{Tab:f=>{f.replaceSelection("  ")},"Ctrl-/":"toggleComment","Cmd-/":"toggleComment","Ctrl-Q":f=>{f.foldCode(f.getCursor())}},lineWrapping:e.isLineWrapped},onChange:(f,C,w)=>{a(w)}}),e.renderDrawer&&u()]})}function rt(e){return t.jsxs(pe,{open:e.isOpen,onClose:e.handleCloseModal,"aria-labelledby":"delete-confirmation-dialog",children:[t.jsxs(fe,{id:"delete-confirmation-dialog-title",children:["Delete ",e.title]}),t.jsx(se,{children:t.jsxs(Ie,{children:["Are you sure you want to delete ",e.item,"? This action cannot be undone."]})}),t.jsxs(ge,{children:[t.jsx(F,{onClick:e.handleCloseModal,color:"primary",children:"Cancel"}),t.jsx(F,{onClick:e.handleDelete,color:"secondary",children:"Delete"})]})]})}const nn=oe(e=>({fileTreeContent:{overflowY:"scroll",height:"100%"},button:{color:e.palette.common.white,background:e.palette.success.main,"&:hover":{background:e.palette.success.dark},border:"8px solid white",fontSize:"13px",width:"100%"},list:{padding:"8px",paddingLeft:"0px",paddingBottom:"0px",fontSize:"13px"},listItemError:{paddingTop:"5px",paddingBottom:"5px",margin:0},listItem:{background:e.palette.common.lightestGrey,paddingTop:"5px",paddingBottom:"5px",marginTop:"5px",marginBottom:"5px",paddingLeft:"5px",margin:0,"&:hover":{background:e.palette.common.lightGrey},display:"block",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},listItemSelected:{background:e.palette.common.editorGrey,color:e.palette.common.white,"&:hover":{background:e.palette.common.darkestGrey}},listHeader:{padding:"5px",paddingLeft:"15px"},listIcon:{color:e.palette.success.main,verticalAlign:"middle",fontSize:"13px",paddingLeft:"3px",paddingRight:"3px"},listIconError:{color:e.palette.common.red},blankIcon:{paddingLeft:"19px"}})),$e=e=>{if(e.resourceType==="ValueSet"||e.resourceType==="CodeSystem")return e.resourceType;if(e.resourceType==="StructureDefinition"){if(e.derivation==="specialization"){if(e.kind==="resource")return"Resource";if(e.kind==="logical")return"Logical Model"}else if(e.derivation==="constraint"){if(e.kind==="complex-type"&&e.type==="Extension")return"Extension";if(["resource","complex-type","primitive-type","logical"].includes(e.kind))return"Profile"}}return e.resourceType!=null?"Instance":null},Ee=e=>e.id?e.id:e.resourceType?`Instance of ${e.resourceType.substring(e.resourceType.lastIndexOf("/")+1)}`:"Untitled",sn=e=>[...e.profiles,...e.extensions,...e.logicals,...e.resources,...e.instances,...e.valueSets,...e.codeSystems].map(s=>({resourceType:$e(s),id:Ee(s),def:JSON.stringify(s,null,2)}));function on(e){const n=nn(),[s,o]=h.useState(""),[r,l]=h.useState([{resourceType:null,id:"Untitled",def:null}]),{setShowNewText:c,updateTextValue:a}=e,[i,d]=h.useState(0),[u,f]=h.useState([]),[C,w]=h.useState(!1);h.useEffect(()=>{if(e.showNewText&&!b.isEqual(e.text,[""])){c(!1);let S;try{S=JSON.parse(e.text)}catch{S={profiles:[],extensions:[],logicals:[],resources:[],instances:[],valueSets:[],codeSystems:[]}}const y=sn(S);l(y),d(0),o(y.length>0?y[0].def:""),a(y)}else e.isWaiting&&(o(null),l([]))},[e.text,e.showNewText,e.isWaiting,a,c]);const m=S=>{if(e.isWaiting)return;const y=[...r];try{const x=S===""?{}:JSON.parse(S);if(u.includes(i)){const j=[...u];j.splice(u.indexOf(i),1),f(j)}r[i]||(y[i]={resourceType:$e(x),id:Ee(x)}),(!r[i]||x.resourceType!==r[i].resourceType)&&(y[i].resourceType=$e(x)),(!r[i]||x.id!==r[i].id)&&(y[i].id=Ee(x))}catch{if(!u.includes(i)){const j=[...u];j.push(i),f(j)}}y[i]&&(y[i].def=S),l(y),e.updateTextValue(y),s===null&&o(S)},k=()=>{const S=[...r];S.push({resourceType:null,id:"Untitled",def:null}),d(S.length-1),l(S),o(null),e.updateTextValue(S)},$=()=>{const S=i,y=[...r];if(y.splice(S,1),y.length===0&&y.push({resourceType:null,id:"Untitled",def:null}),l(y),S<=i){let T=0;S<i&&(T=i-1),d(T);const H=y.length>0?y[T].def:null;o(H)}const x=[...u];u.includes(S)&&x.splice(u.indexOf(S),1);const j=x.map(T=>T<S?T:T-1);f(j),w(!1),e.updateTextValue(y)},z=()=>{w(!0)},Y=()=>{w(!1)},K=(S,y)=>{let x;try{x=JSON.parse(S)}catch{}We.saveAs(new Blob([S]),x!=null&&x.resourceType&&(x!=null&&x.id)?`${x.resourceType}-${x.id}.json`:`${y}.json`)},Z=()=>{const S=r[i];if(!S)return;const y=S.resourceType||"Unknown Type",x=S.id||"Untitled";return t.jsx(rt,{title:"FHIR JSON",item:`${y} ${x}`,isOpen:C,handleCloseModal:Y,handleDelete:$})},V=()=>{const S=["Profiles","Extensions","Logical Models","Resources","ValueSets","CodeSystems","Instances","Unknown Type"],y=b.groupBy(r,x=>x&&x.resourceType?`${x.resourceType}s`:"Unknown Type");return Object.keys(y).sort((x,j)=>S.indexOf(x)-S.indexOf(j)).map(x=>t.jsxs(Nt,{component:"nav",className:n.list,children:[t.jsx("div",{className:n.listHeader,children:x}),y[x].sort((j,T)=>{const H=j.id?j.id:"Untitled",W=T.id?T.id:"Untitled";return H.toLowerCase()<W.toLowerCase()?-1:H.toLowerCase()>W.toLowerCase()?1:0}).map((j,T)=>{const H=r.indexOf(j),W=u.includes(H);return t.jsxs(Ht,{button:!0,title:(j==null?void 0:j.id)||"Untitled","data-testid":`${x}-defId`,className:J(n.listItem,W&&n.listItemError,H===i&&n.listItemSelected),onClick:()=>{d(H),o(j.def)},children:[u.includes(H)?t.jsx(be,{title:"Invalid JSON",placement:"top",arrow:!0,children:t.jsx(Dt,{className:J(n.listIcon,n.listIconError)})}):t.jsx("span",{className:n.blankIcon}),(j==null?void 0:j.id)||"Untitled"]},T)})]},x))},U=()=>t.jsxs(t.Fragment,{children:[t.jsx(F,{className:n.button,startIcon:t.jsx(Ft,{}),onClick:k,children:"New JSON Editor"}),t.jsx("div",{className:n.fileTreeContent,children:V()})]}),O=r.length>0?r[i].def:null,L=`${r.length>0?r[i].id:"Untitled"}`;return t.jsxs(t.Fragment,{children:[t.jsx(Ae,{name:`FHIR JSON: ${L}`,value:O,initialText:s,updateTextValue:m,mode:"application/json",placeholder:e.isWaiting?"Loading...":`Paste or edit single FHIR JSON artifact here... 
Create additional FHIR JSON artifacts to the right.`,renderDrawer:U,isExamples:!1,delete:z,save:()=>K(O,L),isLineWrapped:e.isLineWrapped}),C&&Z()]})}function rn(e){const[n,s]=h.useState(!1),o=()=>{s(!n)},r=()=>{s(!1),e.setInitialText("")},l=()=>{We.saveAs(new Blob([e.text]),"FSH.fsh")};return t.jsxs(t.Fragment,{children:[t.jsx(Ae,{name:"FSH",isExamples:!1,value:e.text,initialText:e.initialText,updateTextValue:e.updateTextValue,mode:"fsh",placeholder:e.isWaiting?"Loading...":"Paste or edit FSH here...",delete:o,save:l,config:e.config,isLineWrapped:e.isLineWrapped}),n&&t.jsx(rt,{title:"FHIR Shorthand",item:"all FSH",isOpen:n,handleCloseModal:o,handleDelete:r})]})}const an=oe(e=>({consoleControls:{background:e.palette.common.darkestGrey,height:"34px",boxSizing:"border-box",display:"flex;",alignItems:"center",justifyContent:"left"},box:{paddingLeft:"29px",color:e.palette.common.white,background:e.palette.common.darkestGrey,height:"calc(100% - 34px)",overflow:"scroll",boxSizing:"border-box"},button:{marginRight:"10px",color:e.palette.common.white,textTransform:"none",padding:0},problemsButton:{padding:0,color:e.palette.common.white,textTransform:"none"},expandIcon:{width:"29px",color:e.palette.common.white,padding:0},pre:{margin:"0px"},circle:{"border-radius":"50%","border-style":"solid","border-width":"2px","min-width":"20px",height:"20px",paddingLeft:1,paddingRight:1,background:"#263238","align-items":"center",display:"flex",marginLeft:4,"justify-content":"center",padding:0}}));function ln(e){const n=an(),[s,o]=h.useState(!1),{problemCount:r,setExpandConsole:l}=e;h.useEffect(()=>{r&&l(!0)},[r,l]);const c=()=>{e.setExpandConsole(!e.expandConsole)},a=()=>{o(!1),e.setExpandConsole(!0)},i=()=>{o(!0),e.setExpandConsole(!0)};return t.jsxs(t.Fragment,{children:[t.jsxs(M,{className:n.consoleControls,children:[t.jsx(we,{onClick:c,"aria-label":e.expandConsole?"collapse console":"expand console",className:n.expandIcon,children:e.expandConsole?t.jsx(st,{}):t.jsx($t,{})}),t.jsx(F,{onClick:a,className:n.button,children:t.jsx("p",{style:{borderBottom:e.expandConsole&&!s?"1px solid white":"none",margin:"0"},children:"Console"})}),t.jsxs(F,{onClick:i,className:n.problemsButton,children:[t.jsx("p",{style:{borderBottom:e.expandConsole&&s?`1px solid ${e.problemCount?e.problemColor:"white"}`:"none",margin:"0"},children:"Problems"}),t.jsx("div",{className:n.circle,style:{borderColor:`${e.problemCount?e.problemColor:"white"}`},children:e.problemCount})]})]}),t.jsx(M,{style:{display:e.expandConsole?"block":"none"},className:n.box,children:s?e.problemMessages.map((d,u)=>t.jsx("pre",{className:n.pre,children:d},u)):e.consoleMessages.map((d,u)=>t.jsx("pre",{className:n.pre,children:d},u))})]})}let E=je.logger;function at(e){e==="sushi"?E=je.logger:e==="gofsh"&&(E=Se.logger)}function cn(e,n,s){let o={resourceArr:e,emptyDependencies:[]};return new Promise(r=>{ot.get(`https://packages.fhir.org/${n}/${s}`,function(l){const c=Et.extract();c.on("entry",function(a,i,d){let u="";i.on("data",function(f){u+=f.toString()}),i.on("end",function(){try{const f=JSON.parse(u);f.resourceType&&o.resourceArr.push(f)}catch{}d()}),i.resume()}),c.on("finish",function(){r(o)}),l.statusCode<400?(l.pipe(Ot.createGunzip()).pipe(c),E.info(`Downloaded ${n}#${s}`)):(s==="current"||s==="dev"?E.error('FSHOnline does not currently support "current" or "dev" package versions'):(E.error(`Your dependency ${n}#${s} could not be loaded. Your output may be invalid.`),o.emptyDependencies.push(`${n}${s}`)),r(o))}).on("error",l=>{E.error("An error occurred while downloading FHIR packages. Your output may be invalid: ",l),o.emptyDependencies.push(`${n}${s}`),r(o)})})}function dn(e,n,s,o){return new Promise((r,l)=>{const c=e.transaction([`${s}${o}`],"readwrite");c.oncomplete=()=>{r()},c.onerror=i=>{l(i)};const a=c.objectStore(`${s}${o}`,{keyPath:["id","resourceType"]});n.forEach(i=>{i.id&&i.resourceType&&a.put(i)})})}function un(e,n,s,o){return new Promise((r,l)=>{let c=!1;const a=n.transaction([`${s}${o}`],"readonly").objectStore(`${s}${o}`,{keyPath:["id","resourceType"]}).openCursor();a.onerror=function(){l("There is an error getting data out!")},a.onsuccess=function(){const i=a.result;i?(c=!0,e.add(i.value),i.continue()):(c&&E.info(`Loaded package ${s}#${o}`),r(e))}})}function hn(e){return new Promise((n,s)=>{const{packageId:o,isAutomatic:r}=e;ot.get(`https://packages.fhir.org/${o}`,function(l){let c="";l.on("data",function(a){c+=a}),l.on("end",function(){var i,d;const a=JSON.parse(c);(d=(i=a==null?void 0:a["dist-tags"])==null?void 0:i.latest)!=null&&d.length?n(a["dist-tags"].latest):(E.error(`Could not determine latest released version of ${r?"automatically-loaded dependency ":""}${o}.`),s("no latest version found"))})})})}const pn=it.FHIRDefinitions,fn=ke.FSHTank,gn=ke.importText;function xn(e,n){E.info("Importing FSH text...");const s=gn(e);return new fn(s,n)}async function lt(e,n){n=await yn(n);let s=await Sn(n),o={defs:e,emptyDependencies:[]};return s.shouldUpdate?(o=await Ke(e,s.version+1,n),e=o.defs):(o=await Ke(e,s.version,n),e=o.defs),await mn(o.emptyDependencies,s.version+2),e}function mn(e,n,s="FSH Playground Dependencies"){const o=b.flatten(e);return new Promise((r,l)=>{let c=null;const a=indexedDB.open(s,n);a.onsuccess=function(i){c=i.target.result,c.close(),r()},a.onupgradeneeded=async function(i){c=i.target.result;let d=c.objectStoreNames;for(let u of d)await new Promise(f=>{const w=i.target.transaction.objectStore(`${u}`).getAll();w.onsuccess=m=>{m.target.result.length===0&&!o.includes(u)&&o.push(u),f()}});for(let u=0;u<o.length;u++)d.contains(o[u])&&c.deleteObjectStore(o[u])},a.onerror=function(i){l(i)}})}function Sn(e,n="FSH Playground Dependencies"){let s={shouldUpdate:!1,version:1};return new Promise((o,r)=>{let l=null;const c=indexedDB.open(n);c.onsuccess=function(a){l=a.target.result;let i=l.objectStoreNames;s.version=l.version,i.length===0||e.length===0||i.contains("resources")?(s.shouldUpdate=!0,l.close(),o(s)):(e.forEach(d=>{const{packageId:u,version:f}=d;i.contains(`${u}${f}`)||(s.shouldUpdate=!0)}),l.close(),o(s))},c.onupgradeneeded=function(a){l=a.target.result},c.onerror=function(a){r(a)}})}async function Ke(e,n,s,o="FSH Playground Dependencies",r=!1){return new Promise((l,c)=>{let a=null,i=[],d={defs:pn,emptyDependencies:[]};const u=indexedDB.open(o,n);u.onsuccess=async function(f){a=f.target.result;for(let C=0;C<s.length;C++){let w=[];r=!1;const{packageId:m,version:k}=s[C];if(i.includes(`${m}${k}`)&&(r=!0),r){let $=await cn(w,m,k);$.emptyDependencies.length!==0&&d.emptyDependencies.push($.emptyDependencies),await dn(a,$.resourceArr,m,k)}d.defs=await un(e,a,m,k)}a.close(),l(d)},u.onupgradeneeded=function(f){a=f.target.result;let C=a.objectStoreNames;C.contains("resources")&&a.deleteObjectStore("resources");for(let w=0;w<s.length;w++){const{packageId:m,version:k}=s[w];C.contains(`${m}${k}`)||(a.createObjectStore(`${m}${k}`,{keyPath:["id","resourceType"]}),i.push(`${m}${k}`))}},u.onerror=function(f){c(f)}})}async function yn(e){return(await Promise.all(e.map(async o=>Cn(o)))).filter(o=>o.version!==null)}async function Cn(e){const{packageId:n,version:s}=e;let o=s;return s==="latest"&&await hn(e).then(r=>{o=r}).catch(()=>{o=null}),{packageId:n,version:o}}function ct(e){return e.split(",").map(s=>{const o=s.trim();if(o==="")return o;const[r,l]=o.split("#");return{packageId:r,version:l}}).filter(s=>s)}const bn=ke.FSHTank,wn=ke.RawFSH,jn=Rt.exportFHIR,Oe=je.stats,ne=Se.stats,dt=je.getRandomPun,vn=je.Type,ut=it.FHIRDefinitions;async function In(e,n){ne.reset(),at("gofsh");const s=[];e.forEach((m,k)=>{const $=`Input_${k}`;try{m=JSON.parse(m),m.resourceType||E.error(`FHIR JSON ${m.id??$} is missing the required "resourceType" property`)}catch{E.error(`Could not parse ${$} to JSON`);return}Se.isProcessableContent(m,$)&&s.push(new Te.WildFHIR({content:m},$))});const o=new Te.LakeOfFHIR(s);let r=new ut;const l=new Se.MasterFisher(o,r),c=new Te.FHIRProcessor(o,l),a=n.dependencies.map(m=>m.replace("#","@")),i=c.processConfig(a??[]);let d=i!=null&&i.config.dependencies?i==null?void 0:i.config.dependencies.map(m=>`${m.packageId}#${m.version}`):[];d=ct(d.join(","));const u=(i==null?void 0:i.config.fhirVersion[0])??"4.0.1",f=ht(d,u);d.push(...f),r=await lt(r,d);const C=await Se.getResources(c,i,{indent:n.indent}),w=new Lt.FSHExporter(C).apiExport("string");return E.info("Done converting definitions"),Fn(C),{fsh:w,config:(i==null?void 0:i.config)??{}}}async function kn(e,n,s=[]){Oe.reset(),at("sushi");let o=new ut;const r=ht(s,n.fhirVersion[0]);s.push(...r),o=await lt(o,s);let l=bn;try{const d=[new wn(e)];l=xn(d,n)}catch{E.error("Something went wrong when importing the FSH definitions");return}const c=o.fishForFHIR("StructureDefinition",vn.Resource);if((c==null?void 0:c.version)!==n.fhirVersion[0]){E.error("StructureDefinition resource not found. The FHIR package in the browser cache may be corrupt. Clear cookies and site data on this webpage to reload the FHIR package.");return}E.info("Converting FSH to FHIR resources...");const a=jn(l,o),i=a.profiles.length+a.extensions.length+a.logicals.length+a.resources.length+a.instances.filter(d=>d._instanceMeta.usage!=="Inline").length+a.valueSets.length+a.codeSystems.length;return E.info(`Exported ${i} FHIR resources as JSON.`),console.log(" "),Tn(a),a.profiles=a.profiles.map(d=>d.toJSON(!1)),a.extensions=a.extensions.map(d=>d.toJSON(!1)),a.logicals=a.logicals.map(d=>d.toJSON(!1)),a.resources=a.resources.map(d=>d.toJSON(!1)),a.instances=a.instances.filter(d=>d._instanceMeta.usage!=="Inline"),a}function Tn(e){const n=Oe.numError,s=Oe.numWarn,o=b.pad(e.profiles.length.toString(),13),r=b.pad(e.extensions.length.toString(),12),l=b.pad(e.logicals.length.toString(),12),c=b.pad(e.resources.length.toString(),13),a=b.pad(e.valueSets.length.toString(),18),i=b.pad(e.codeSystems.length.toString(),17),d=b.pad(e.instances.length.toString(),18),u=b.pad(`${n} Error${n!==1?"s":""}`,13),f=b.padStart(`${s} Warning${s!==1?"s":""}`,12),C=b.padEnd(dt(n,s),36);["╔════════════════════════ SUSHI RESULTS ══════════════════════════╗","║ ╭───────────────┬──────────────┬──────────────┬───────────────╮ ║","║ │    Profiles   │  Extensions  │   Logicals   │   Resources   │ ║","║ ├───────────────┼──────────────┼──────────────┼───────────────┤ ║",`║ │ ${o} │ ${r} │ ${l} │ ${c} │ ║`,"║ ╰───────────────┴──────────────┴──────────────┴───────────────╯ ║","║ ╭────────────────────┬───────────────────┬────────────────────╮ ║","║ │      ValueSets     │    CodeSystems    │     Instances      │ ║","║ ├────────────────────┼───────────────────┼────────────────────┤ ║",`║ │ ${a} │ ${i} │ ${d} │ ║`,"║ ╰────────────────────┴───────────────────┴────────────────────╯ ║","║                                                                 ║","╠═════════════════════════════════════════════════════════════════╣",`║ ${C} ${u} ${f} ║`,"╚═════════════════════════════════════════════════════════════════╝"].forEach(m=>console.log(m))}function Fn(e){const n=b.pad(e.profiles.length.toString(),18),s=b.pad(e.extensions.length.toString(),17),o=b.pad(e.logicals.length.toString(),18),r=b.pad(e.resources.length.toString(),18),l=b.pad(e.valueSets.length.toString(),17),c=b.pad(e.codeSystems.length.toString(),18),a=b.pad(e.instances.length.toString(),18),i=b.pad(e.invariants.length.toString(),17),d=b.pad(e.mappings.length.toString(),18),u=b.pad(`${ne.numError} Error${ne.numError!==1?"s":""}`,12),f=b.padStart(`${ne.numWarn} Warning${ne.numWarn!==1?"s":""}`,12),C=b.padEnd(dt(ne.numError,ne.numWarn),37),w=["╔═════════════════════════ GoFSH RESULTS ═════════════════════════╗","║ ╭────────────────────┬───────────────────┬────────────────────╮ ║","║ │      Profiles      │    Extensions     │      Logicals      │ ║","║ ├────────────────────┼───────────────────┼────────────────────┤ ║",`║ │ ${n} │ ${s} │ ${o} │ ║`,"║ ╰────────────────────┴───────────────────┴────────────────────╯ ║","║ ╭────────────────────┬───────────────────┬────────────────────╮ ║","║ │     Resources      │     ValueSets     │     CodeSystems    │ ║","║ ├────────────────────┼───────────────────┼────────────────────┤ ║",`║ │ ${r} │ ${l} │ ${c} │ ║`,"║ ╰────────────────────┴───────────────────┴────────────────────╯ ║","║ ╭────────────────────┬───────────────────┬────────────────────╮ ║","║ │     Instances      │    Invariants     │      Mappings      │ ║","║ ├────────────────────┼───────────────────┼────────────────────┤ ║",`║ │ ${a} │ ${i} │ ${d} │ ║`,"║ ╰────────────────────┴───────────────────┴────────────────────╯ ║","║                                                                 ║","╠═════════════════════════════════════════════════════════════════╣",`║ ${C} ${u} ${f} ║`,"╚═════════════════════════════════════════════════════════════════╝"];console.log(" "),w.forEach(m=>console.log(m))}function ht(e,n){const s=[],o={packageId:Nn(n),version:n};return Ze(e,o)||s.push(o),Hn.filter(l=>l.fhirVersions==null||l.fhirVersions.some(c=>o.version.startsWith(c))).forEach(l=>{const c={packageId:l.packageId,version:l.version,isAutomatic:!0};Ze(e,c,!0)||s.push(c)}),s}function Ze(e,n,s=!1){return e.some(o=>o.packageId===n.packageId&&(s||o.version===n.version))}function Nn(e){return/^4\.0\.1$/.test(e)?"hl7.fhir.r4.core":/^4\.3\.\d+$/.test(e)?"hl7.fhir.r4b.core":/^5\.0\.\d+$/.test(e)?"hl7.fhir.r5.core":"hl7.fhir.r4.core"}const Hn=[{packageId:"hl7.fhir.uv.tools",version:"latest"},{packageId:"hl7.terminology.r4",version:"latest",fhirVersions:["4.0","4.3"]},{packageId:"hl7.terminology.r5",version:"latest",fhirVersions:["5.0"]},{packageId:"hl7.fhir.uv.extensions.r4",version:"latest",fhirVersions:["4.0","4.3"]},{packageId:"hl7.fhir.uv.extensions.r5",version:"latest",fhirVersions:["5.0"]}],Dn=oe(e=>({box:{padding:e.spacing(1),color:e.palette.text.primary,background:e.palette.background.paper,display:"flex;",alignItems:"center",justifyContent:"center"},rightControls:{position:"absolute",right:"24px"},leftControls:{position:"absolute",left:"28px"},secondaryButton:{color:e.palette.success.main,"&:hover":{background:e.palette.common.lighterBlue}},progressContainer:{width:"24px",height:"24px"},progress:{height:"1em !important",width:"1em !important",verticalAlign:"middle",color:e.palette.common.white},button:{color:e.palette.common.white,background:e.palette.success.main,borderRadius:"0",paddingRight:"15px",paddingLeft:"15px","&:hover":{background:e.palette.success.dark}},buttonLeft:{float:"right",left:"-3.33px"},buttonRight:{float:"left",right:"-0.67px"},runIcon:{padding:"0px"},dialogPaper:{maxHeight:"80vh",minHeight:"80vh"},dialogActions:{justifyContent:"space-between"},dialogActionsMessage:{fontStyle:"italic",padding:"6px 8px"}}));function $n(e,n){if(e!=="config")return n}function En(e){const n=Dn(),[s,o]=h.useState(!1),[r,l]=h.useState(!1),[c,a]=h.useState(""),[i,d]=h.useState(""),[u,f]=h.useState(""),[C,w]=h.useState(""),[m,k]=h.useState(!1),[$,z]=h.useState(!1),[Y,K]=h.useState(!1),[Z,V]=h.useState(!1),[U,O]=h.useState(""),[L,S]=h.useState("");h.useEffect(()=>{var g,v,N,G,A;a(((g=e.config)==null?void 0:g.canonical)||""),d(((v=e.config)==null?void 0:v.version)||""),f(((G=(N=e.config)==null?void 0:N.fhirVersion)==null?void 0:G.length)>0?e.config.fhirVersion.at(0):""),w(((A=e.config)==null?void 0:A.dependencies)||"")},[e.config]);const y=()=>{o(!0)},x=()=>{o(!1),O("")},j=()=>{l(!0)},T=()=>{l(!1),e.onConfigChange({canonical:c,version:i,fhirVersion:[u],dependencies:C,isGoFSHIndented:m})},H=g=>{const v=g.target.value;a(v)},W=g=>{const v=g.target.value;d(v)},q=g=>{const v=g.target.value;f(v)},ie=g=>{const v=g.target.value;w(v)},re=g=>{const v=g.target.checked;k(v)},ae=g=>{const v=g.target.checked;e.setIsLineWrapped(v)};async function le(){if(e.isWaiting)return;e.resetLogMessages(),e.onSUSHIClick(!0,[""],!0),z(!0);const g=ct(C),v={canonical:c||"http://example.org",version:i||"1.0.0",FSHOnly:!0,fhirVersion:u?[u]:["4.0.1"]},N=await kn(e.fshText,v,g);let G=JSON.stringify(N,$n,2);N&&N.codeSystems?!N.codeSystems.length&&!N.extensions.length&&!N.instances.length&&!N.profiles.length&&!N.logicals.length&&!N.resources.length&&!N.valueSets.length&&(G=[""]):G=[""],e.onSUSHIClick(!0,G,!1),z(!1)}async function ce(){if(e.isWaiting)return;e.resetLogMessages(),e.onGoFSHClick("",!0),K(!0);const g=e.gofshText.map(p=>p.def).filter(p=>p),v=C===""?[]:C.split(",");if(c||i||u!==""){const p={resourceType:"ImplementationGuide",fhirVersion:u?[u]:["4.0.1"],id:"1",...c&&{url:`${c}/ImplementationGuide/1`},...i&&{version:i}};g.push(JSON.stringify(p,null,2))}const N={dependencies:v,indent:m},{fsh:G,config:A}=await In(g,N);e.onGoFSHClick(G,!1),K(!1),c===""&&A.canonical&&a(A.canonical),i===""&&A.version&&d(A.version),u===""&&A.fhirVersion&&f(A.fhirVersion.at(0))}async function de(g,v){if(!v.endsWith(".fsh"))return;const N=e.exampleMetadata[v];V(!0),S(N.name);const G=new TextDecoder("utf-8");let A=await fetch(N.path).then(D=>D.body.getReader()),p="";const{value:I}=await A.read();p+=G.decode(I),V(!1),O(p)}function Q(g){O(g)}function ue(){navigator.clipboard.writeText(U)}const ve=g=>t.jsx(be,{title:e.exampleMetadata[g.id]&&e.exampleMetadata[g.id].description?e.exampleMetadata[g.id].description:g.name,placement:"bottom",arrow:!0,children:t.jsx(Ye,{nodeId:g.id,label:g.name,className:n.treeItem},g.id)},g.id),he=g=>t.jsx(Ye,{nodeId:g.id,label:g.name,children:g.children?g.children.map(v=>v.children?he(v):ve(v)):null},g.id);return t.jsxs(M,{className:n.box,children:[t.jsx("div",{className:n.leftControls,children:t.jsxs(F,{name:"Examples",className:n.button,onClick:y,children:[t.jsx(Wt,{}),"   FSH Examples"]})}),t.jsxs(_,{container:!0,children:[t.jsx(_,{item:!0,xs:5,children:t.jsxs(F,{className:J(n.button,n.buttonLeft),onClick:le,testid:"Button",children:["Convert to JSON",$?t.jsx("div",{className:n.progressContainer,children:t.jsx(Je,{className:n.progress})}):t.jsx(ze,{className:n.runIcon})]})}),t.jsx(_,{item:!0,xs:7,children:t.jsxs(F,{className:J(n.button,n.buttonRight),onClick:ce,testid:"GoFSH-button",children:[Y?t.jsx("div",{className:n.progressContainer,children:t.jsx(Je,{className:n.progress})}):t.jsx(ze,{className:n.runIcon,style:{transform:"scaleX(-1)"}}),"Convert to FSH"]})})]}),t.jsxs("div",{className:n.rightControls,children:[t.jsxs(F,{name:"SaveAll",className:n.secondaryButton,onClick:e.saveAll,children:[t.jsx(tt,{})," Save All"]}),t.jsxs(F,{name:"Configuration",className:n.secondaryButton,onClick:j,children:[t.jsx(Gt,{})," Configuration"]})]}),t.jsxs(pe,{open:r,onClose:T,"aria-labelledby":"form-dialog-title",children:[t.jsx(fe,{id:"form-dialog-title",children:"Configuration Settings"}),t.jsxs(se,{children:[t.jsx(Ie,{children:"Change the Implementation Guide configuration to use when processing FSH and FHIR JSON"}),t.jsx(me,{id:"canonical",margin:"dense",fullWidth:!0,label:"Canonical URL",helperText:"Default: http://example.org",defaultValue:c,onChange:H}),t.jsx(me,{id:"version",margin:"dense",fullWidth:!0,label:"Version",helperText:"Default: 1.0.0",defaultValue:i,onChange:W}),t.jsxs(me,{id:"fhir-version-select",margin:"dense",fullWidth:!0,select:!0,label:"FHIR Version",helperText:"Default: 4.0.1 (R4)",value:u,onChange:q,children:[t.jsx(Fe,{value:"4.0.1",children:"4.0.1 (R4)"}),t.jsx(Fe,{value:"4.3.0",children:"4.3.0 (R4B)"}),t.jsx(Fe,{value:"5.0.0",children:"5.0.0 (R5)"})]}),t.jsx(me,{id:"dependencies",margin:"dense",fullWidth:!0,label:"Dependencies",helperText:"Format: packageId#version, packageId#version (e.g., hl7.fhir.us.core#6.0.0)",defaultValue:C,onChange:ie}),t.jsx(_e,{id:"goFSHIndent",margin:"dense",control:t.jsx(qe,{checked:m,color:"primary"}),label:"Indent output of Convert to FSH",onChange:re}),t.jsx(Xe,{children:"If set, Convert to FSH will output FSH using path rules"}),t.jsx(_e,{id:"lineWrap",margin:"dense",control:t.jsx(qe,{checked:e.isLineWrapped,color:"primary"}),label:"Line wrap within code editors",onChange:ae}),t.jsx(Xe,{children:"If set, FSH Online will display code with line wrapping"})]}),t.jsx(ge,{children:t.jsx(F,{onClick:T,color:"primary",children:"Done"})})]}),t.jsxs(pe,{open:s,onClose:x,"aria-labelledby":"form-dialog-title",maxWidth:"lg",fullWidth:!0,scroll:"paper",classes:{paper:n.dialogPaper},children:[t.jsx(fe,{id:"form-dialog-title",children:"FSH Examples"}),t.jsx(se,{children:t.jsxs(_,{container:!0,style:{overflow:"scroll",minHeight:"64vh"},children:[t.jsx(_,{item:!0,xs:4,children:t.jsx(At,{className:n.treeView,defaultCollapseIcon:t.jsx(st,{}),defaultExpandIcon:t.jsx(nt,{}),onNodeSelect:de,children:e.exampleConfig.map(g=>he(g))})}),t.jsx(_,{item:!0,xs:8,children:t.jsx(Ae,{name:U?L:"",isExamples:!0,value:U,initialText:U,updateTextValue:Q,mode:"fsh",placeholder:Z?"Fetching example...":"Select an example",isLineWrapped:e.isLineWrapped})})]})}),t.jsxs(ge,{className:n.dialogActions,children:[t.jsxs("div",{className:n.dialogActionsMessage,children:["Have an example that might be bene-fish-al? Seas the day and add to our collection on"," ",t.jsx(et,{href:"https://github.com/FSHSchool/FSHOnline-Examples#readme",children:"GitHub"}),"!"]}),t.jsxs("div",{children:[t.jsxs(F,{onClick:ue,color:"primary",children:[t.jsx(Mt,{})," Copy to clipboard"]}),t.jsx(F,{onClick:x,color:"secondary",children:"Close"})]})]})]})]})}const On=oe(()=>({container:{height:"100%",flexGrow:1},fullHeightGrid:{height:"100%"},editorPane:{flexGrow:"0"},resize:{height:"100%",width:"4px",cursor:"col-resize","&:hover":{background:Ge.palette.common.lightBlue}},resizeBlue:{background:"#487AA2"},resizeCursor:{cursor:"col-resize"},collapsedMain:{width:"100%",height:"calc(100vh - 116px - 300px)"},expandedMain:{width:"100%",height:"calc(100vh - 116px - 34px)"},collapsedConsole:{height:"25px",width:"100%"},expandedConsole:{height:"300px",width:"100%"},top:{height:"116px"}})),pt="https://raw.githubusercontent.com/FSHSchool/FSHOnline-Examples/main/",Me="There are no messages to display in the console.",Pe="There are no problems to display in the console.";let ye=[Me],Ce=[Pe],Re=0,Le="#FDD835",ft={};console.log=function(n){n&&(n.startsWith("error")||n.startsWith("warn"))&&(Ce[0]===Pe&&(Ce=[]),Re++,Ce.push(n),n.startsWith("error")&&(Le="#FD6668")),ye[0]===Me&&(ye=[]),ye.push(n)};function gt(e){e.forEach(n=>{n.type==="category"&&gt(n.children),n.id=n.path.replaceAll("%20","-"),n.type==="file"&&(ft[n.id]={path:`${pt}/Examples/${n.path}`,description:n.description,name:n.name}),delete n.type,delete n.path})}async function Rn(){let e=await fetch(`${pt}/index.json`).then(n=>n.json());return gt(e.children),[...e.children]}async function Ln(e){if(e.text===void 0)return"";{const n=await Xt(e),s=n.long_url.slice(40);return!n.long_url.includes("https://fshschool.org/FSHOnline/#/share/")||s.length===0?"":De.inflateSync(Vt.from(s,"base64")).toString("utf-8")}}async function Wn(e){const n=await fetch(`https://api.github.com/gists/${e}`).then(o=>o.json());let s="";for(let o of Object.values((n==null?void 0:n.files)||{}))o.truncated?s+=await fetch(o.raw_url).then(r=>r.text()):s+=o.content,s+=`

`;return s.trim()}const xt=h.createContext(!1);function He(e){const n=On(),s=e.match,[o,r]=h.useState(!1),[l,c]=h.useState(""),[a,i]=h.useState([""]),[d,u]=h.useState(""),[f,C]=h.useState(!1),[w,m]=h.useState(!1),[k,$]=h.useState(!1),[z,Y]=h.useState([]),[K,Z]=h.useState({}),[V,U]=h.useState(41.666667),[O,L]=h.useState(!1),[S,y]=h.useState({canonical:"",version:"",fhirVersion:[],dependencies:""}),[x,j]=h.useState({}),[T,H]=h.useState(!1);h.useEffect(()=>{async function p(){if(/\/share/.test(s.path)){const D=await Ln(s.params),X=D.indexOf(`
`),R=D.slice(0,X);let P,ee=D;try{const B=JSON.parse(R);B.c!=null&&B.v!=null&&B.d!=null&&(P={canonical:B.c,version:B.v,fhirVersion:B.f||[],dependencies:B.d},ee=D.slice(X+1))}catch{}j(P||{}),u(ee)}else if(/\/gist/.test(s.path)){const D=await Wn(s.params.id);u(D)}}async function I(){Y(await Rn()),Z(ft)}p(),I()},[s]);function W(){ye=[Me],Ce=[Pe],Re=0,Le="#FDD835"}function q(p,I,D){r(p),i(I),C(D)}function ie(p,I){m(I),u(p===""?null:p)}function re(p){(d===""||d===null)&&u(p),c(p)}function ae(p){i(p)}function le(p){y(p)}function ce(){U(41.666667)}function de(p){p.preventDefault(),L(!0)}function Q(p){p.preventDefault(),L(!1)}function ue(){L(!0)}function ve(){L(!1)}function he(p){H(p)}function g(p){if(O){const I=p/window.innerWidth*100;I>10&&I<76&&U(I)}}function v(p){const I=p.clientX;O&&b.debounce(()=>g(I),10)()}function N(p){const I=p.touches[0].clientX;O&&b.debounce(()=>g(I),10)()}function G(p,I){if(I.get(p)){let D=I.get(p),X=`${p}-${D}`;for(;I.get(X);)D=D+1,X=`${p}-${D}`;I.set(p,D+1),p=X,I.set(X,1)}else I.set(p,1);return p}function A(){const p=new Map,I=new Bt;I.file("FSH.fsh",l);const[D,X]=b.partition(a,R=>R.id&&R.id!=="Untitled");D.forEach(R=>{let P;try{P=JSON.parse(R.def)}catch{}const ee=G(P!=null&&P.resourceType?`${P.resourceType}-${R.id}`:R.id,p),B=R.def??null;I.file(`${ee}.json`,B)}),X.forEach(R=>{let P;try{P=JSON.parse(R.def)}catch{}const ee=R.id??"Untitled",B=G(P.resourceType?`${P.resourceType}-${ee}`:ee,p),mt=R.def??null;I.file(`${B}.json`,mt)}),I.generateAsync({type:"blob"}).then(R=>{We.saveAs(R,"fshonline.zip")})}return t.jsx(Pt,{theme:Ge,children:t.jsxs("div",{className:"root",style:{height:"100vh"},children:[t.jsxs("div",{className:n.top,children:[t.jsx(Zt,{}),t.jsx(En,{onSUSHIClick:q,onGoFSHClick:ie,onConfigChange:le,config:x,fshText:l,gofshText:a,resetLogMessages:W,exampleConfig:z,exampleMetadata:K,isWaiting:w||f,saveAll:A,setIsLineWrapped:he,isLineWrapped:T})]}),t.jsx("div",{className:k?n.collapsedMain:n.expandedMain,children:t.jsx(xt.Provider,{value:k,children:t.jsxs(_,{className:J(n.container,O&&n.resizeCursor),container:!0,onTouchMove:N,onMouseMove:v,onMouseUp:Q,onMouseLeave:Q,children:[t.jsx(_,{item:!0,className:J(n.fullHeightGrid,n.editorPane),style:{maxWidth:`calc(${V}% - 2px)`,flexBasis:`calc(${V}% - 2px)`},children:t.jsx(rn,{text:l,initialText:d,updateTextValue:re,isWaiting:w,setInitialText:u,config:S,isLineWrapped:T})}),t.jsx(_,{item:!0,className:J(n.resize,O&&n.resizeBlue),onTouchStart:ue,onTouchEnd:ve,onMouseDown:de,onDoubleClick:ce}),t.jsx(_,{item:!0,className:J(n.fullHeightGrid,n.editorPane),style:{maxWidth:`calc(${100-V}% - 2px)`,flexBasis:`calc(${100-V}% - 2px)`},children:t.jsx(on,{text:a,showNewText:o,setShowNewText:r,isWaiting:f,updateTextValue:ae,isLineWrapped:T})})]})})}),t.jsx("div",{className:k?n.expandedConsole:n.collapsedConsole,children:t.jsx(ln,{consoleMessages:ye,problemMessages:Ce,problemCount:Re,problemColor:Le,expandConsole:k,setExpandConsole:$})})]})})}function Gn(){return t.jsxs(Ut,{children:[t.jsx(Ne,{path:"/share/:text",component:He}),t.jsx(Ne,{path:"/gist/:id",component:He}),t.jsx(Ne,{path:"",exact:!0,component:He})]})}Jt.render(t.jsx(zt.StrictMode,{children:t.jsx(_t,{basename:"/",children:t.jsx(Gn,{})})}),document.getElementById("root"));

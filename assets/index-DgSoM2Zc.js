import{m as ae,j as t,A as wt,T as jt,B as W,S as qe,a as Ye,b as N,E as vt,c as It,r as h,d as ge,I as fe,L as kt,D as xe,e as me,f as re,g as ke,l as He,F as st,C as Tt,h as Se,i as ot,k as Ce,n as Te,o as Ft,p as z,U as Nt,q as it,s as Dt,t as Ht,u as $t,v as rt,w as j,x as Ue,y as Et,z as Rt,G as Lt,H as Ot,J as at,K as Wt,M as ve,N as be,O as lt,P as Gt,Q as Bt,R as ct,V as Fe,W as Mt,X as $e,Y as At,Z as Pt,_ as X,$ as Ke,a0 as Ze,a1 as Vt,a2 as Ee,a3 as Re,a4 as Le,a5 as Oe,a6 as Ut,a7 as Jt,a8 as Qe,a9 as zt,aa as _t,ab as Xt,ac as et,ad as qt,ae as We,af as Yt,ag as Kt,ah as Zt}from"./vendor-BUUyLRFD.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function i(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(r){if(r.ep)return;r.ep=!0;const a=i(r);fetch(r.href,a)}})();const Qt="/assets/FSH-online-logo-BTt1RVAN.png",en=ae(e=>({root:{background:e.palette.common.blue,position:"static",boxShadow:"0"},title:{fontSize:20,fontWeight:700},logo:{height:"55px",width:"63px"},toolbarBox:{alignItems:"center"},exitIcon:{paddingLeft:"3px",transform:"scaleX(-1)"},docButton:{color:e.palette.common.white,backgroundColor:e.palette.common.blue,fontSize:"0.875rem",fontWeight:700,"&:hover":{background:e.palette.common.lightBlue}},versionText:{color:e.palette.common.white,fontSize:"0.8rem",fontStyle:"italic",marginTop:"-5px"}}));function tn(){const e=en();return t.jsx(wt,{className:e.root,children:t.jsx(jt,{children:t.jsxs(W,{className:e.toolbarBox,display:"flex",flexGrow:1,flexDirection:"row",children:[t.jsxs(W,{order:1,display:"flex",flexGrow:1,flexDirection:"row",children:[t.jsx(W,{order:1,alignSelf:"center",display:"flex",children:t.jsx("img",{src:Qt,alt:"logo",className:e.logo})}),t.jsx(W,{order:2,alignSelf:"center",m:1,children:t.jsxs(qe,{injectFirst:!0,children:[t.jsx(Ye,{order:1,className:e.title,children:"FSH ONLINE"}),t.jsx(Ye,{order:2,className:e.versionText,children:"Powered by SUSHI v3.12.0 and GoFSH v2.3.1"})]})})]}),t.jsx(W,{order:1,children:t.jsx(qe,{injectFirst:!0,children:t.jsxs(N,{className:e.docButton,href:"https://fshschool.org/",target:"_blank",children:[t.jsx(vt,{className:e.exitIcon,fontSize:"small"}),"Back to School"]})})})]})})})}const oe={lighterBlue:"#D8E2EA",lightBlue:"#487AA2",blue:"#30638e",darkerBlue:"#143E61",editorGrey:"#263238",lightestGrey:"#E7ECEE",lightGrey:"#D0D9DD",grey:"#575B5C",darkerGrey:"#3D4345",darkestGrey:"#121D21",red:"#FD6668"},Je=It({palette:{success:{main:oe.blue,dark:oe.darkerBlue,light:oe.lightBlue},common:oe},typography:{fontFamily:"Open Sans"},overrides:{MuiTooltip:{tooltip:{backgroundColor:oe.darkestGrey,fontSize:"13px"},arrow:{color:oe.darkestGrey}},MuiButton:{text:{textTransform:"none",fontWeight:600}},MuiIconButton:{root:{"&:hover":{backgroundColor:oe.grey}}}}}),nn=ae(e=>({iconButton:{color:e.palette.common.white,padding:"3px"},textArea:{width:"100%",color:e.palette.text.primary,fontWeight:"bold"},copyBox:{backgroundColor:e.palette.common.lightestGrey,borderRadius:2,display:"flex",justifyContent:"space-between",alignItems:"center",paddingLeft:"15px",paddingRight:"5px"},linkBox:{paddingTop:"15px",paddingBottom:"15px",paddingRight:"5px",whiteSpace:"nowrap",overflowX:"scroll",textOverflow:"ellipsis"},copyButton:{padding:"8px",borderRadius:0,"&:hover":{background:e.palette.common.lightGrey}}}));function sn(e){const n=nn(),[i,o]=h.useState(!1),[r,a]=h.useState(!1),[c,d]=h.useState(!1),[s,u]=h.useState(!1),[l,p]=h.useState("Copy to Clipboard"),[C,b]=h.useState("Copy Formatted Link to Clipboard"),[{fshCopied:v,fshCopyButton:y},L]=h.useState({fshCopied:!1,fshCopyButton:"Copy FSH to Clipboard"}),[E,q]=h.useState(),[Y,te]=h.useState(),[V,B]=h.useState(!0),O=K=>{var Q;const Z=(Q=K.target.value.match(/gist\.github\.com\/[^/]+\/(.+)/))==null?void 0:Q[1];Z&&te(`https://fshonline.fshschool.org/#/gist/${Z}`)},U=()=>{a(!0),m()},m=()=>{o(!1),d(!0),te(""),L({fshCopied:!1,fshCopyButton:"Copy FSH to Clipboard"})},S=()=>{d(!1),a(!1)},f=()=>{Y?(S(),q(Y),o(!0),p("Copy to Clipboard"),b("Copy Formatted Link to Clipboard"),B(!1)):u(!0)},I=()=>{u(!1)},T=async()=>{var Q,le,ce,de,ue,he,pe,ne;let K;(Q=e.config)!=null&&Q.canonical||(le=e.config)!=null&&le.version||((ce=e.config)==null?void 0:ce.fhirVersion.length)>0||(de=e.config)!=null&&de.dependencies?K=Te.deflateSync(JSON.stringify({c:(ue=e.config)==null?void 0:ue.canonical,v:(he=e.config)==null?void 0:he.version,f:(pe=e.config)==null?void 0:pe.fhirVersion,d:(ne=e.config)==null?void 0:ne.dependencies})+`
`+e.shareText).toString("base64"):K=Te.deflateSync(e.shareText).toString("base64");const Z=`https://fshonline.fshschool.org/#/share/${K}`;Z.length>2048?U():(q(Z),o(!0),p("Copy to Clipboard"),b("Copy Formatted Link to Clipboard"),B(!0))},H=()=>{o(!1),a(!1)},_=()=>{L({fshCopied:!0,fshCopyButton:"FSH Copied to Clipboard"})};return t.jsxs(t.Fragment,{children:[t.jsx(ge,{title:"Share FSH",placement:"top",arrow:!0,children:t.jsx(fe,{name:"Share FSH",className:n.iconButton,onClick:T,children:t.jsx(kt,{fontSize:"small",style:{transform:"rotate(-45deg)"}})})}),t.jsxs(xe,{open:i,onClose:H,"aria-labelledby":"form-dialog-title",maxWidth:"md",fullWidth:!0,children:[t.jsx(me,{id:"form-dialog-title",children:"Share"}),t.jsxs(re,{children:[t.jsx(ke,{children:"Use this link to share your FSH with others!"}),t.jsxs(W,{className:n.copyBox,children:[t.jsx(W,{className:n.linkBox,children:E}),t.jsxs(W,{sx:{display:"flex",flexWrap:"nowrap"},children:[t.jsx(ge,{title:l,placement:"top",arrow:!0,children:t.jsx(fe,{className:n.copyButton,children:t.jsx(He.CopyToClipboard,{text:E,onCopy:()=>p("Link Copied"),children:t.jsx(st,{fontSize:"small"})})})}),t.jsx(ge,{title:C,placement:"top",arrow:!0,children:t.jsx(fe,{className:n.copyButton,children:t.jsx(He.CopyToClipboard,{text:`[FSH Online Link](${E})`,onCopy:()=>b("Link Copied"),options:{format:"text/plain"},children:t.jsx(Tt,{fontSize:"small"})})})})]})]})]}),t.jsxs(Se,{children:[V&&t.jsx(N,{onClick:m,color:"primary",style:{align:"left"},children:"Create Link with Gist"}),t.jsx(W,{style:{flex:"1 0 0",hidden:!0}}),t.jsx(N,{onClick:H,color:"primary",children:"Done"})]})]}),t.jsxs(xe,{open:c,onClose:S,"aria-labelledby":"alert-dialog-title",maxWidth:"md",fullWidth:!0,children:[t.jsx(me,{id:"alert-dialog-title",children:"Share with Gist"}),r&&t.jsx(re,{style:{color:Je.palette.common.red},children:"Your FSH content is too long to share directly. Please use a Gist to share."}),t.jsxs(re,{children:["Create a"," ",t.jsx(ot,{id:"gistURL",href:"https://gist.github.com/",target:"_blank",children:"Gist"})," ","and paste the URL below to generate a shareable FSH Online link.",t.jsx(Ce,{id:"gistURLText",label:"Gist URL",fullWidth:!0,onChange:O})]}),t.jsxs(Se,{style:{bottom:0,right:0},children:[t.jsx(N,{onClick:S,color:"primary",children:"Cancel"}),t.jsx(W,{style:{flex:"1 0 0",hidden:!0}}),t.jsx(He.CopyToClipboard,{text:e.shareText,onCopy:_,style:{align:"left"},children:t.jsx(N,{color:v?"secondary":"primary",children:y})}),t.jsx(N,{color:"primary",onClick:f,style:{align:"left"},children:"Generate Link from Gist"})]})]}),t.jsxs(xe,{open:s,onClose:I,"aria-labelledby":"alert-dialog-title",maxWidth:"lg",children:[t.jsx(me,{id:"alert-dialog-title",children:"Error Creating Gist Link"}),t.jsx(re,{children:t.jsx(ke,{children:"Could not generate a link from your Gist URL. Ensure the URL is valid."})}),t.jsx(Se,{children:t.jsx(N,{onClick:I,color:"primary",children:"Keep Swimming!"})})]})]})}Ft.defineSimpleMode("fsh",{meta:{lineComment:"//"},start:[{regex:/"(?:[^\\]|\\.)*?(?:"|$)/,token:"atom"},{regex:/\b(Alias|Characteristics|Context|CodeSystem|Expression|Extension|Description|Id|Instance|InstanceOf|Invariant|Logical|Mapping|Mixins|Parent|Profile|Resource|RuleSet|Severity|Source|Target|Title|Usage|ValueSet|XPath)(?=\s*:)\b/,token:"keyword"},{regex:/(\s|^)(and|codes|contains|descendent-of|exclude|exists|from system|from|generalizes|include|in|insert|is-a|is-not-a|named|not-in|obeys|only|or|regex|units|valueset|where|D|MS|N|SU|TU|\\?!)(\s|$)/,token:"def"},{regex:/(\(\s*)(exactly|example|extensible|preferred|required)(\s*\))/,token:"def"},{regex:/\b(CodeableReference|Reference|Canonical)\s*\(/,push:"closingParen",token:"atom"},{regex:/\*|->|=|\+|:/,token:"def"},{regex:/\b(https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_+.~#?&//=]*))\b/,token:"atom"},{regex:/(\s|^)(true|false)(\s|$)/,token:"string"},{regex:/(\s|^)(-?\d+(\.\d+)?)(\s|^)/,token:"string"},{regex:/#"(?:\\.|[^\\"])*"/,token:"string"},{regex:/#[^\s]*/,token:"string"},{regex:/'.*'/,token:"string"},{regex:/\s\/\/.*/,token:"comment"},{regex:/\/\/.*/,token:"comment",sol:!0},{regex:/\/\*/,token:"comment",next:"comment"}],closingParen:[{regex:/\)/,pop:!0,token:"atom"}],comment:[{regex:/.*?\*\//,token:"comment",next:"start"},{regex:/.*/,token:"comment"}]});const ye=200,on=ae(e=>({box:{height:"100%"},header:{fontFamily:"Open Sans",color:e.palette.common.white,background:e.palette.common.darkerGrey,padding:"0px",paddingLeft:"29px",height:"34px",display:"flex",justifyContent:"space-between",transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},headerShift:{width:`calc(100% - ${ye}px - 29px)`,transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginRight:ye},headerLabel:{lineHeight:"34px",float:"left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},headerActionGroup:{paddingRight:"10px"},headerActions:{alignItems:"center",display:"flex"},iconButton:{color:e.palette.common.white,padding:"3px"},drawer:{width:ye,flexShrink:0},drawerPaper:{width:ye,border:"none",height:"calc(100vh - 116px - 34px)",top:"116px"},drawerPaperExpandedConsole:{height:"calc(100vh - 116px - 300px)"},drawerHeader:{display:"flex",alignItems:"center",justifyContent:"flex-start",color:e.palette.common.white,background:e.palette.common.darkerGrey,height:"34px",minHeight:"34px"},drawerHeaderIcon:{padding:"0px",color:e.palette.common.white,background:e.palette.success.main,"&:hover":{background:e.palette.success.light},borderRadius:0,height:"100%",width:"34px",minWidth:"34px"},content:{flexGrow:1,width:"100%",transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},contentShift:{width:`calc(100% - ${ye}px)`,transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginRight:0}}));function ze(e){const n=on(),i=h.useContext(Ct),[o,r]=h.useState(!0),a=()=>{r(!0)},c=()=>{r(!1)};function d(p){e.updateTextValue(p)}const s=(p,C,b,v={})=>t.jsx(ge,{title:j.upperFirst(C),placement:"top",arrow:!0,children:t.jsx(fe,{name:C,className:n.iconButton,"aria-label":C,onClick:b,children:t.jsx(p,{fontSize:"small",style:v})})}),u=()=>t.jsxs("div",{className:n.headerActions,children:[t.jsxs("div",{className:n.headerActionGroup,children:[e.mode==="fsh"&&!e.isExamples&&t.jsx(sn,{shareText:e.value,config:e.config}),e.copy&&s(st,"copy",()=>{}),e.save&&s(it,"save",e.save),e.delete&&s(Dt,"delete",e.delete)]}),e.renderDrawer&&!o&&t.jsx(fe,{name:"expand",className:n.drawerHeaderIcon,"aria-label":"expand",onClick:a,children:t.jsx(Ht,{})})]}),l=()=>t.jsxs($t,{className:n.drawer,"data-testid":"editor-drawer",variant:"persistent",anchor:"right",open:o,classes:{paper:z(n.drawerPaper,i&&n.drawerPaperExpandedConsole)},children:[t.jsx("div",{className:n.drawerHeader,children:t.jsx(N,{name:"collapse","aria-label":"collapse",className:n.drawerHeaderIcon,onClick:c,children:t.jsx(rt,{})})}),e.renderDrawer()]});return t.jsxs(W,{className:n.box,children:[t.jsxs("div",{className:z(n.header,{[n.headerShift]:e.renderDrawer&&o}),children:[t.jsx("div",{title:e.name,className:n.headerLabel,children:e.name}),u()]}),t.jsx(Nt,{className:z("react-codemirror2",e.renderDrawer&&n.content,{[n.contentShift]:e.renderDrawer&&o}),value:e.initialText,options:{mode:e.mode,theme:"material",placeholder:e.placeholder,scrollbarStyle:"overlay",autoCloseBrackets:!0,lineNumbers:!0,foldGutter:!0,readOnly:e.isExamples,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],extraKeys:{Tab:p=>{p.replaceSelection("  ")},"Ctrl-/":"toggleComment","Cmd-/":"toggleComment","Ctrl-Q":p=>{p.foldCode(p.getCursor())}},lineWrapping:e.isLineWrapped},onChange:(p,C,b)=>{d(b)}}),e.renderDrawer&&l()]})}function dt(e){return t.jsxs(xe,{open:e.isOpen,onClose:e.handleCloseModal,"aria-labelledby":"delete-confirmation-dialog",children:[t.jsxs(me,{id:"delete-confirmation-dialog-title",children:["Delete ",e.title]}),t.jsx(re,{children:t.jsxs(ke,{children:["Are you sure you want to delete ",e.item,"? This action cannot be undone."]})}),t.jsxs(Se,{children:[t.jsx(N,{onClick:e.handleCloseModal,color:"primary",children:"Cancel"}),t.jsx(N,{onClick:e.handleDelete,color:"secondary",children:"Delete"})]})]})}const rn=ae(e=>({fileTreeContent:{overflowY:"scroll",height:"100%"},button:{color:e.palette.common.white,background:e.palette.success.main,"&:hover":{background:e.palette.success.dark},border:"8px solid white",fontSize:"13px",width:"100%"},list:{padding:"8px",paddingLeft:"0px",paddingBottom:"0px",fontSize:"13px"},listItemError:{paddingTop:"5px",paddingBottom:"5px",margin:0},listItem:{background:e.palette.common.lightestGrey,paddingTop:"5px",paddingBottom:"5px",marginTop:"5px",marginBottom:"5px",paddingLeft:"5px",margin:0,"&:hover":{background:e.palette.common.lightGrey},display:"block",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},listItemSelected:{background:e.palette.common.editorGrey,color:e.palette.common.white,"&:hover":{background:e.palette.common.darkestGrey}},listHeader:{padding:"5px",paddingLeft:"15px"},listIcon:{color:e.palette.success.main,verticalAlign:"middle",fontSize:"13px",paddingLeft:"3px",paddingRight:"3px"},listIconError:{color:e.palette.common.red},blankIcon:{paddingLeft:"19px"}})),Be=e=>{if(e.resourceType==="ValueSet"||e.resourceType==="CodeSystem")return e.resourceType;if(e.resourceType==="StructureDefinition"){if(e.derivation==="specialization"){if(e.kind==="resource")return"Resource";if(e.kind==="logical")return"Logical Model"}else if(e.derivation==="constraint"){if(e.kind==="complex-type"&&e.type==="Extension")return"Extension";if(["resource","complex-type","primitive-type","logical"].includes(e.kind))return"Profile"}}return e.resourceType!=null?"Instance":null},Me=e=>{if(e.id)if(typeof e.id=="object"){if(e.id.value)return e.id.value}else return e.id;return e.resourceType?`Instance of ${e.resourceType.substring(e.resourceType.lastIndexOf("/")+1)}`:"Untitled"},an=e=>[...e.profiles,...e.extensions,...e.logicals,...e.resources,...e.instances,...e.valueSets,...e.codeSystems].map(i=>({resourceType:Be(i),id:Me(i),def:JSON.stringify(i,null,2)}));function ln(e){const n=rn(),[i,o]=h.useState(""),[r,a]=h.useState([{resourceType:null,id:"Untitled",def:null}]),{setShowNewText:c,updateTextValue:d}=e,[s,u]=h.useState(0),[l,p]=h.useState([]),[C,b]=h.useState(!1);h.useEffect(()=>{if(e.showNewText&&!j.isEqual(e.text,[""])){c(!1);let m;try{m=JSON.parse(e.text)}catch{m={profiles:[],extensions:[],logicals:[],resources:[],instances:[],valueSets:[],codeSystems:[]}}const S=an(m);a(S),u(0),o(S.length>0?S[0].def:""),d(S)}else e.isWaiting&&(o(null),a([]))},[e.text,e.showNewText,e.isWaiting,d,c]);const v=m=>{if(e.isWaiting)return;const S=[...r];try{const f=m===""?{}:JSON.parse(m);if(l.includes(s)){const I=[...l];I.splice(l.indexOf(s),1),p(I)}r[s]||(S[s]={resourceType:Be(f),id:Me(f)}),(!r[s]||f.resourceType!==r[s].resourceType)&&(S[s].resourceType=Be(f)),(!r[s]||f.id!==r[s].id)&&(S[s].id=Me(f))}catch{if(!l.includes(s)){const I=[...l];I.push(s),p(I)}}S[s]&&(S[s].def=m),a(S),e.updateTextValue(S),i===null&&o(m)},y=()=>{const m=[...r];m.push({resourceType:null,id:"Untitled",def:null}),u(m.length-1),a(m),o(null),e.updateTextValue(m)},L=()=>{const m=s,S=[...r];if(S.splice(m,1),S.length===0&&S.push({resourceType:null,id:"Untitled",def:null}),a(S),m<=s){let T=0;m<s&&(T=s-1),u(T);const H=S.length>0?S[T].def:null;o(H)}const f=[...l];l.includes(m)&&f.splice(l.indexOf(m),1);const I=f.map(T=>T<m?T:T-1);p(I),b(!1),e.updateTextValue(S)},E=()=>{b(!0)},q=()=>{b(!1)},Y=(m,S)=>{let f;try{f=JSON.parse(m)}catch{}Ue.saveAs(new Blob([m]),f!=null&&f.resourceType&&(f!=null&&f.id)?`${f.resourceType}-${f.id}.json`:`${S}.json`)},te=()=>{const m=r[s];if(!m)return;const S=m.resourceType||"Unknown Type",f=m.id||"Untitled";return t.jsx(dt,{title:"FHIR JSON",item:`${S} ${f}`,isOpen:C,handleCloseModal:q,handleDelete:L})},V=()=>{const m=["Profiles","Extensions","Logical Models","Resources","ValueSets","CodeSystems","Instances","Unknown Type"],S=j.groupBy(r,f=>f&&f.resourceType?`${f.resourceType}s`:"Unknown Type");return Object.keys(S).sort((f,I)=>m.indexOf(f)-m.indexOf(I)).map(f=>t.jsxs(Rt,{component:"nav",className:n.list,children:[t.jsx("div",{className:n.listHeader,children:f}),S[f].sort((I,T)=>{const H=I.id?I.id:"Untitled",_=T.id?T.id:"Untitled";return H.toLowerCase()<_.toLowerCase()?-1:H.toLowerCase()>_.toLowerCase()?1:0}).map((I,T)=>{const H=r.indexOf(I),_=l.includes(H);return t.jsxs(Lt,{button:!0,title:(I==null?void 0:I.id)||"Untitled","data-testid":`${f}-defId`,className:z(n.listItem,_&&n.listItemError,H===s&&n.listItemSelected),onClick:()=>{u(H),o(I.def)},children:[l.includes(H)?t.jsx(ge,{title:"Invalid JSON",placement:"top",arrow:!0,children:t.jsx(Ot,{className:z(n.listIcon,n.listIconError)})}):t.jsx("span",{className:n.blankIcon}),(I==null?void 0:I.id)||"Untitled"]},T)})]},f))},B=()=>t.jsxs(t.Fragment,{children:[t.jsx(N,{className:n.button,startIcon:t.jsx(Et,{}),onClick:y,children:"New JSON Editor"}),t.jsx("div",{className:n.fileTreeContent,children:V()})]}),O=r.length>0?r[s].def:null,U=`${r.length>0?r[s].id:"Untitled"}`;return t.jsxs(t.Fragment,{children:[t.jsx(ze,{name:`FHIR JSON: ${U}`,value:O,initialText:i,updateTextValue:v,mode:"application/json",placeholder:e.isWaiting?"Loading...":`Paste or edit single FHIR JSON artifact here... 
Create additional FHIR JSON artifacts to the right.`,renderDrawer:B,isExamples:!1,delete:E,save:()=>Y(O,U),isLineWrapped:e.isLineWrapped}),C&&te()]})}function cn(e){const[n,i]=h.useState(!1),o=()=>{i(!n)},r=()=>{i(!1),e.setInitialText("")},a=()=>{Ue.saveAs(new Blob([e.text]),"FSH.fsh")};return t.jsxs(t.Fragment,{children:[t.jsx(ze,{name:"FSH",isExamples:!1,value:e.text,initialText:e.initialText,updateTextValue:e.updateTextValue,mode:"fsh",placeholder:e.isWaiting?"Loading...":"Paste or edit FSH here...",delete:o,save:a,config:e.config,isLineWrapped:e.isLineWrapped}),n&&t.jsx(dt,{title:"FHIR Shorthand",item:"all FSH",isOpen:n,handleCloseModal:o,handleDelete:r})]})}const dn=ae(e=>({consoleControls:{background:e.palette.common.darkestGrey,height:"34px",boxSizing:"border-box",display:"flex;",alignItems:"center",justifyContent:"left"},box:{paddingLeft:"29px",color:e.palette.common.white,background:e.palette.common.darkestGrey,height:"calc(100% - 34px)",overflow:"scroll",boxSizing:"border-box"},button:{marginRight:"10px",color:e.palette.common.white,textTransform:"none",padding:0},problemsButton:{padding:0,color:e.palette.common.white,textTransform:"none"},expandIcon:{width:"29px",color:e.palette.common.white,padding:0},pre:{margin:"0px"},circle:{"border-radius":"50%","border-style":"solid","border-width":"2px","min-width":"20px",height:"20px",paddingLeft:1,paddingRight:1,background:"#263238","align-items":"center",display:"flex",marginLeft:4,"justify-content":"center",padding:0}}));function un(e){const n=dn(),[i,o]=h.useState(!1),{problemCount:r,setExpandConsole:a}=e;h.useEffect(()=>{r&&a(!0)},[r,a]);const c=()=>{e.setExpandConsole(!e.expandConsole)},d=()=>{o(!1),e.setExpandConsole(!0)},s=()=>{o(!0),e.setExpandConsole(!0)};return t.jsxs(t.Fragment,{children:[t.jsxs(W,{className:n.consoleControls,children:[t.jsx(fe,{onClick:c,"aria-label":e.expandConsole?"collapse console":"expand console",className:n.expandIcon,children:e.expandConsole?t.jsx(at,{}):t.jsx(Wt,{})}),t.jsx(N,{onClick:d,className:n.button,children:t.jsx("p",{style:{borderBottom:e.expandConsole&&!i?"1px solid white":"none",margin:"0"},children:"Console"})}),t.jsxs(N,{onClick:s,className:n.problemsButton,children:[t.jsx("p",{style:{borderBottom:e.expandConsole&&i?`1px solid ${e.problemCount?e.problemColor:"white"}`:"none",margin:"0"},children:"Problems"}),t.jsx("div",{className:n.circle,style:{borderColor:`${e.problemCount?e.problemColor:"white"}`},children:e.problemCount})]})]}),t.jsx(W,{style:{display:e.expandConsole?"block":"none"},className:n.box,children:i?e.problemMessages.map((u,l)=>t.jsx("pre",{className:n.pre,children:u},l)):e.consoleMessages.map((u,l)=>t.jsx("pre",{className:n.pre,children:u},l))})]})}let D=ve.logger;function ut(e,n){e==="sushi"?D=ve.logger:e==="gofsh"&&(D=be.logger),D.level=n}function hn(e,n,i){let o={resourceArr:e,emptyDependencies:[]};return new Promise(r=>{lt.get(`https://packages.fhir.org/${n}/${i}`,function(a){const c=Gt.extract();c.on("entry",function(d,s,u){let l="";s.on("data",function(p){l+=p.toString()}),s.on("end",function(){try{const p=JSON.parse(l);p.resourceType&&o.resourceArr.push(p)}catch{}u()}),s.resume()}),c.on("finish",function(){r(o)}),a.statusCode<400?(a.pipe(Bt.createGunzip()).pipe(c),D.info(`Downloaded ${n}#${i}`)):(i==="current"||i==="dev"?D.error('FSHOnline does not currently support "current" or "dev" package versions'):(D.error(`Your dependency ${n}#${i} could not be loaded. Your output may be invalid.`),o.emptyDependencies.push(`${n}${i}`)),r(o))}).on("error",a=>{D.error("An error occurred while downloading FHIR packages. Your output may be invalid: ",a),o.emptyDependencies.push(`${n}${i}`),r(o)})})}function pn(e,n,i,o){return new Promise((r,a)=>{const c=e.transaction([`${i}${o}`],"readwrite");c.oncomplete=()=>{r()},c.onerror=s=>{a(s)};const d=c.objectStore(`${i}${o}`,{keyPath:["id","resourceType"]});n.forEach(s=>{s.id&&s.resourceType&&d.put(s)})})}function gn(e,n,i,o){return new Promise((r,a)=>{let c=!1;const d=n.transaction([`${i}${o}`],"readonly").objectStore(`${i}${o}`,{keyPath:["id","resourceType"]}).openCursor();d.onerror=function(){a("There is an error getting data out!")},d.onsuccess=function(){const s=d.result;s?(c=!0,e.add(s.value),s.continue()):(c&&D.info(`Loaded package ${i}#${o}`),r(e))}})}function fn(e){return new Promise((n,i)=>{const{packageId:o,isAutomatic:r}=e;lt.get(`https://packages.fhir.org/${o}`,function(a){let c="";a.on("data",function(d){c+=d}),a.on("end",function(){var s,u;const d=JSON.parse(c);(u=(s=d==null?void 0:d["dist-tags"])==null?void 0:s.latest)!=null&&u.length?n(d["dist-tags"].latest):(D.error(`Could not determine latest released version of ${r?"automatically-loaded dependency ":""}${o}.`),i("no latest version found"))})})})}const xn=ct.FHIRDefinitions,mn=Fe.FSHTank,Sn=Fe.importText;function yn(e,n){D.info("Importing FSH text...");const i=Sn(e);return new mn(i,n)}async function ht(e,n){n=await wn(n);let i=await bn(n),o={defs:e,emptyDependencies:[]};return i.shouldUpdate?(o=await tt(e,i.version+1,n),e=o.defs):(o=await tt(e,i.version,n),e=o.defs),await Cn(o.emptyDependencies,i.version+2),e}function Cn(e,n,i="FSH Playground Dependencies"){const o=j.flatten(e);return new Promise((r,a)=>{let c=null;const d=indexedDB.open(i,n);d.onsuccess=function(s){c=s.target.result,c.close(),r()},d.onupgradeneeded=async function(s){c=s.target.result;let u=c.objectStoreNames;for(let l of u)await new Promise(p=>{const b=s.target.transaction.objectStore(`${l}`).getAll();b.onsuccess=v=>{v.target.result.length===0&&!o.includes(l)&&o.push(l),p()}});for(let l=0;l<o.length;l++)u.contains(o[l])&&c.deleteObjectStore(o[l])},d.onerror=function(s){a(s)}})}function bn(e,n="FSH Playground Dependencies"){let i={shouldUpdate:!1,version:1};return new Promise((o,r)=>{let a=null;const c=indexedDB.open(n);c.onsuccess=function(d){a=d.target.result;let s=a.objectStoreNames;i.version=a.version,s.length===0||e.length===0||s.contains("resources")?(i.shouldUpdate=!0,a.close(),o(i)):(e.forEach(u=>{const{packageId:l,version:p}=u;s.contains(`${l}${p}`)||(i.shouldUpdate=!0)}),a.close(),o(i))},c.onupgradeneeded=function(d){a=d.target.result},c.onerror=function(d){r(d)}})}async function tt(e,n,i,o="FSH Playground Dependencies",r=!1){return new Promise((a,c)=>{let d=null,s=[],u={defs:xn,emptyDependencies:[]};const l=indexedDB.open(o,n);l.onsuccess=async function(p){d=p.target.result;for(let C=0;C<i.length;C++){let b=[];r=!1;const{packageId:v,version:y}=i[C];if(s.includes(`${v}${y}`)&&(r=!0),r){let L=await hn(b,v,y);L.emptyDependencies.length!==0&&u.emptyDependencies.push(L.emptyDependencies),await pn(d,L.resourceArr,v,y)}u.defs=await gn(e,d,v,y)}d.close(),a(u)},l.onupgradeneeded=function(p){d=p.target.result;let C=d.objectStoreNames;C.contains("resources")&&d.deleteObjectStore("resources");for(let b=0;b<i.length;b++){const{packageId:v,version:y}=i[b];C.contains(`${v}${y}`)||(d.createObjectStore(`${v}${y}`,{keyPath:["id","resourceType"]}),s.push(`${v}${y}`))}},l.onerror=function(p){c(p)}})}async function wn(e){return(await Promise.all(e.map(async o=>jn(o)))).filter(o=>o.version!==null)}async function jn(e){const{packageId:n,version:i}=e;let o=i;return i==="latest"&&await fn(e).then(r=>{o=r}).catch(()=>{o=null}),{packageId:n,version:o}}function pt(e){return e.split(",").map(i=>{const o=i.trim();if(o==="")return o;const[r,a]=o.split("#");return{packageId:r,version:a}}).filter(i=>i)}const vn=Fe.FSHTank,In=Fe.RawFSH,kn=Mt.exportFHIR,Ae=ve.stats,ie=be.stats,gt=ve.getRandomPun,Tn=ve.Type,ft=ct.FHIRDefinitions;async function Fn(e,n,i){ie.reset(),ut("gofsh",i);const o=[];e.forEach((y,L)=>{const E=`Input_${L}`;try{y=JSON.parse(y),y.resourceType||D.error(`FHIR JSON ${y.id??E} is missing the required "resourceType" property`)}catch{D.error(`Could not parse ${E} to JSON`);return}be.isProcessableContent(y,E)&&o.push(new $e.WildFHIR({content:y},E))});const r=new $e.LakeOfFHIR(o);let a=new ft;const c=new be.MasterFisher(r,a),d=new $e.FHIRProcessor(r,c),s=n.dependencies.map(y=>y.replace("#","@")),u=d.processConfig(s??[]);let l=u!=null&&u.config.dependencies?u==null?void 0:u.config.dependencies.map(y=>`${y.packageId}#${y.version}`):[];l=pt(l.join(","));const p=(u==null?void 0:u.config.fhirVersion[0])??"4.0.1",C=xt(l,p);l.push(...C),a=await ht(a,l);const b=await be.getResources(d,u,{indent:n.indent}),v=new At.FSHExporter(b).apiExport("string");return D.info("Done converting definitions"),Hn(b),{fsh:v,config:(u==null?void 0:u.config)??{}}}async function Nn(e,n,i=[],o){Ae.reset(),ut("sushi",o);let r=new ft;const a=xt(i,n.fhirVersion[0]);i.push(...a),r=await ht(r,i);let c=vn;try{const l=[new In(e)];c=yn(l,n)}catch{D.error("Something went wrong when importing the FSH definitions");return}const d=r.fishForFHIR("StructureDefinition",Tn.Resource);if((d==null?void 0:d.version)!==n.fhirVersion[0]){D.error("StructureDefinition resource not found. The FHIR package in the browser cache may be corrupt. Clear cookies and site data on this webpage to reload the FHIR package.");return}D.info("Converting FSH to FHIR resources...");const s=kn(c,r),u=s.profiles.length+s.extensions.length+s.logicals.length+s.resources.length+s.instances.filter(l=>l._instanceMeta.usage!=="Inline").length+s.valueSets.length+s.codeSystems.length;return D.info(`Exported ${u} FHIR resources as JSON.`),console.log(" "),Dn(s),s.profiles=s.profiles.map(l=>l.toJSON(!1)),s.extensions=s.extensions.map(l=>l.toJSON(!1)),s.logicals=s.logicals.map(l=>l.toJSON(!1)),s.resources=s.resources.map(l=>l.toJSON(!1)),s.instances=s.instances.filter(l=>l._instanceMeta.usage!=="Inline"),s}function Dn(e){const n=Ae.numError,i=Ae.numWarn,o=j.pad(e.profiles.length.toString(),13),r=j.pad(e.extensions.length.toString(),12),a=j.pad(e.logicals.length.toString(),12),c=j.pad(e.resources.length.toString(),13),d=j.pad(e.valueSets.length.toString(),18),s=j.pad(e.codeSystems.length.toString(),17),u=j.pad(e.instances.length.toString(),18),l=j.pad(`${n} Error${n!==1?"s":""}`,13),p=j.padStart(`${i} Warning${i!==1?"s":""}`,12),C=j.padEnd(gt(n,i),36);["╔════════════════════════ SUSHI RESULTS ══════════════════════════╗","║ ╭───────────────┬──────────────┬──────────────┬───────────────╮ ║","║ │    Profiles   │  Extensions  │   Logicals   │   Resources   │ ║","║ ├───────────────┼──────────────┼──────────────┼───────────────┤ ║",`║ │ ${o} │ ${r} │ ${a} │ ${c} │ ║`,"║ ╰───────────────┴──────────────┴──────────────┴───────────────╯ ║","║ ╭────────────────────┬───────────────────┬────────────────────╮ ║","║ │      ValueSets     │    CodeSystems    │     Instances      │ ║","║ ├────────────────────┼───────────────────┼────────────────────┤ ║",`║ │ ${d} │ ${s} │ ${u} │ ║`,"║ ╰────────────────────┴───────────────────┴────────────────────╯ ║","║                                                                 ║","╠═════════════════════════════════════════════════════════════════╣",`║ ${C} ${l} ${p} ║`,"╚═════════════════════════════════════════════════════════════════╝"].forEach(v=>console.log(v))}function Hn(e){const n=j.pad(e.profiles.length.toString(),18),i=j.pad(e.extensions.length.toString(),17),o=j.pad(e.logicals.length.toString(),18),r=j.pad(e.resources.length.toString(),18),a=j.pad(e.valueSets.length.toString(),17),c=j.pad(e.codeSystems.length.toString(),18),d=j.pad(e.instances.length.toString(),18),s=j.pad(e.invariants.length.toString(),17),u=j.pad(e.mappings.length.toString(),18),l=j.pad(`${ie.numError} Error${ie.numError!==1?"s":""}`,12),p=j.padStart(`${ie.numWarn} Warning${ie.numWarn!==1?"s":""}`,12),C=j.padEnd(gt(ie.numError,ie.numWarn),37),b=["╔═════════════════════════ GoFSH RESULTS ═════════════════════════╗","║ ╭────────────────────┬───────────────────┬────────────────────╮ ║","║ │      Profiles      │    Extensions     │      Logicals      │ ║","║ ├────────────────────┼───────────────────┼────────────────────┤ ║",`║ │ ${n} │ ${i} │ ${o} │ ║`,"║ ╰────────────────────┴───────────────────┴────────────────────╯ ║","║ ╭────────────────────┬───────────────────┬────────────────────╮ ║","║ │     Resources      │     ValueSets     │     CodeSystems    │ ║","║ ├────────────────────┼───────────────────┼────────────────────┤ ║",`║ │ ${r} │ ${a} │ ${c} │ ║`,"║ ╰────────────────────┴───────────────────┴────────────────────╯ ║","║ ╭────────────────────┬───────────────────┬────────────────────╮ ║","║ │     Instances      │    Invariants     │      Mappings      │ ║","║ ├────────────────────┼───────────────────┼────────────────────┤ ║",`║ │ ${d} │ ${s} │ ${u} │ ║`,"║ ╰────────────────────┴───────────────────┴────────────────────╯ ║","║                                                                 ║","╠═════════════════════════════════════════════════════════════════╣",`║ ${C} ${l} ${p} ║`,"╚═════════════════════════════════════════════════════════════════╝"];console.log(" "),b.forEach(v=>console.log(v))}function xt(e,n){const i=[],o={packageId:$n(n),version:n};return nt(e,o)||i.push(o),En.filter(a=>a.fhirVersions==null||a.fhirVersions.some(c=>o.version.startsWith(c))).forEach(a=>{const c={packageId:a.packageId,version:a.version,isAutomatic:!0};nt(e,c,!0)||i.push(c)}),i}function nt(e,n,i=!1){return e.some(o=>o.packageId===n.packageId&&(i||o.version===n.version))}function $n(e){return/^4\.0\.1$/.test(e)?"hl7.fhir.r4.core":/^4\.3\.\d+$/.test(e)?"hl7.fhir.r4b.core":/^5\.0\.\d+$/.test(e)?"hl7.fhir.r5.core":"hl7.fhir.r4.core"}const En=[{packageId:"hl7.fhir.uv.tools",version:"latest"},{packageId:"hl7.terminology.r4",version:"latest",fhirVersions:["4.0","4.3"]},{packageId:"hl7.terminology.r5",version:"latest",fhirVersions:["5.0"]},{packageId:"hl7.fhir.uv.extensions.r4",version:"latest",fhirVersions:["4.0","4.3"]},{packageId:"hl7.fhir.uv.extensions.r5",version:"latest",fhirVersions:["5.0"]}],Rn=ae(e=>({box:{padding:e.spacing(1),color:e.palette.text.primary,background:e.palette.background.paper,display:"flex;",alignItems:"center",justifyContent:"center"},rightControls:{position:"absolute",right:"24px"},leftControls:{position:"absolute",left:"28px"},secondaryButton:{color:e.palette.success.main,"&:hover":{background:e.palette.common.lighterBlue}},progressContainer:{width:"24px",height:"24px"},progress:{height:"1em !important",width:"1em !important",verticalAlign:"middle",color:e.palette.common.white},button:{color:e.palette.common.white,background:e.palette.success.main,borderRadius:"0",paddingRight:"15px",paddingLeft:"15px","&:hover":{background:e.palette.success.dark}},buttonLeft:{float:"right",left:"-3.33px"},buttonRight:{float:"left",right:"-0.67px"},runIcon:{padding:"0px"},dialogPaper:{maxHeight:"80vh",minHeight:"80vh"},dialogActions:{justifyContent:"space-between"},dialogActionsMessage:{fontStyle:"italic",padding:"6px 8px"}}));function Ln(e,n){if(e!=="config")return n}function On(e){const n=Rn(),[i,o]=h.useState(!1),[r,a]=h.useState(!1),[c,d]=h.useState(""),[s,u]=h.useState(""),[l,p]=h.useState(""),[C,b]=h.useState(""),[v,y]=h.useState(!1),[L,E]=h.useState(!1),[q,Y]=h.useState(!1),[te,V]=h.useState(!1),[B,O]=h.useState(""),[U,m]=h.useState("");h.useEffect(()=>{var g,w,F,M,G;d(((g=e.config)==null?void 0:g.canonical)||""),u(((w=e.config)==null?void 0:w.version)||""),p(((M=(F=e.config)==null?void 0:F.fhirVersion)==null?void 0:M.length)>0?e.config.fhirVersion.at(0):""),b(((G=e.config)==null?void 0:G.dependencies)||"")},[e.config]);const S=()=>{o(!0)},f=()=>{o(!1),O("")},I=()=>{a(!0)},T=()=>{a(!1),e.onConfigChange({canonical:c,version:s,fhirVersion:[l],dependencies:C,isGoFSHIndented:v})},H=g=>{const w=g.target.value;d(w)},_=g=>{const w=g.target.value;u(w)},K=g=>{const w=g.target.value;p(w)},Z=g=>{const w=g.target.value;b(w)},Q=g=>{const w=g.target.checked;y(w)},le=g=>{const w=g.target.checked;e.setIsLineWrapped(w)},ce=g=>{const w=g.target.checked;e.setIsDebugConsoleChecked(w)};async function de(){if(e.isWaiting)return;e.resetLogMessages(),e.onSUSHIClick(!0,[""],!0),E(!0);const g=pt(C),w={canonical:c||"http://example.org",version:s||"1.0.0",FSHOnly:!0,fhirVersion:l?[l]:["4.0.1"]},F=await Nn(e.fshText,w,g,e.isDebugConsoleChecked?"debug":"info");let M=JSON.stringify(F,Ln,2);F&&F.codeSystems?!F.codeSystems.length&&!F.extensions.length&&!F.instances.length&&!F.profiles.length&&!F.logicals.length&&!F.resources.length&&!F.valueSets.length&&(M=[""]):M=[""],e.onSUSHIClick(!0,M,!1),E(!1)}async function ue(){if(e.isWaiting)return;e.resetLogMessages(),e.onGoFSHClick("",!0),Y(!0);const g=e.gofshText.map(J=>J.def).filter(J=>J),w=C===""?[]:C.split(",");if(c||s||l!==""){const J={resourceType:"ImplementationGuide",fhirVersion:l?[l]:["4.0.1"],id:"1",...c&&{url:`${c}/ImplementationGuide/1`},...s&&{version:s}};g.push(JSON.stringify(J,null,2))}const F={dependencies:w,indent:v},{fsh:M,config:G}=await Fn(g,F,e.isDebugConsoleChecked?"debug":"info");e.onGoFSHClick(M,!1),Y(!1),c===""&&G.canonical&&d(G.canonical),s===""&&G.version&&u(G.version),l===""&&G.fhirVersion&&p(G.fhirVersion.at(0))}async function he(g,w){if(!w.endsWith(".fsh"))return;const F=e.exampleMetadata[w];V(!0),m(F.name);const M=new TextDecoder("utf-8");let G=await fetch(F.path).then(x=>x.body.getReader()),J="";const{value:De}=await G.read();J+=M.decode(De),V(!1),O(J)}function pe(g){O(g)}function ne(){navigator.clipboard.writeText(B)}const Ne=g=>t.jsx(ge,{title:e.exampleMetadata[g.id]&&e.exampleMetadata[g.id].description?e.exampleMetadata[g.id].description:g.name,placement:"bottom",arrow:!0,children:t.jsx(Qe,{nodeId:g.id,label:g.name,className:n.treeItem},g.id)},g.id),Ie=g=>t.jsx(Qe,{nodeId:g.id,label:g.name,children:g.children?g.children.map(w=>w.children?Ie(w):Ne(w)):null},g.id);return t.jsxs(W,{className:n.box,children:[t.jsx("div",{className:n.leftControls,children:t.jsxs(N,{name:"Examples",className:n.button,onClick:S,children:[t.jsx(Pt,{}),"   FSH Examples"]})}),t.jsxs(X,{container:!0,children:[t.jsx(X,{item:!0,xs:5,children:t.jsxs(N,{className:z(n.button,n.buttonLeft),onClick:de,testid:"Button",children:["Convert to JSON",L?t.jsx("div",{className:n.progressContainer,children:t.jsx(Ke,{className:n.progress})}):t.jsx(Ze,{className:n.runIcon})]})}),t.jsx(X,{item:!0,xs:7,children:t.jsxs(N,{className:z(n.button,n.buttonRight),onClick:ue,testid:"GoFSH-button",children:[q?t.jsx("div",{className:n.progressContainer,children:t.jsx(Ke,{className:n.progress})}):t.jsx(Ze,{className:n.runIcon,style:{transform:"scaleX(-1)"}}),"Convert to FSH"]})})]}),t.jsxs("div",{className:n.rightControls,children:[t.jsxs(N,{name:"SaveAll",className:n.secondaryButton,onClick:e.saveAll,children:[t.jsx(it,{})," Save All"]}),t.jsxs(N,{name:"Configuration",className:n.secondaryButton,onClick:I,children:[t.jsx(Vt,{})," Configuration"]})]}),t.jsxs(xe,{open:r,onClose:T,"aria-labelledby":"form-dialog-title",children:[t.jsx(me,{id:"form-dialog-title",children:"Configuration Settings"}),t.jsxs(re,{children:[t.jsx(ke,{children:"Change the Implementation Guide configuration to use when processing FSH and FHIR JSON"}),t.jsx(Ce,{id:"canonical",margin:"dense",fullWidth:!0,label:"Canonical URL",helperText:"Default: http://example.org",defaultValue:c,onChange:H}),t.jsx(Ce,{id:"version",margin:"dense",fullWidth:!0,label:"Version",helperText:"Default: 1.0.0",defaultValue:s,onChange:_}),t.jsxs(Ce,{id:"fhir-version-select",margin:"dense",fullWidth:!0,select:!0,label:"FHIR Version",helperText:"Default: 4.0.1 (R4)",value:l,onChange:K,children:[t.jsx(Ee,{value:"4.0.1",children:"4.0.1 (R4)"}),t.jsx(Ee,{value:"4.3.0",children:"4.3.0 (R4B)"}),t.jsx(Ee,{value:"5.0.0",children:"5.0.0 (R5)"})]}),t.jsx(Ce,{id:"dependencies",margin:"dense",fullWidth:!0,label:"Dependencies",helperText:"Format: packageId#version, packageId#version (e.g., hl7.fhir.us.core#6.0.0)",defaultValue:C,onChange:Z}),t.jsx(Re,{id:"goFSHIndent",margin:"dense",control:t.jsx(Le,{checked:v,color:"primary"}),label:"Indent output of Convert to FSH",onChange:Q}),t.jsx(Oe,{children:"If set, Convert to FSH will output FSH using path rules"}),t.jsx(Re,{id:"lineWrap",margin:"dense",control:t.jsx(Le,{checked:e.isLineWrapped,color:"primary"}),label:"Line wrap within code editors",onChange:le}),t.jsx(Oe,{children:"If set, FSH Online will display code with line wrapping"}),t.jsx(Re,{id:"debugLevelConsole",margin:"dense",control:t.jsx(Le,{checked:e.isDebugConsoleChecked,color:"primary"}),label:"Debug level console messages",onChange:ce}),t.jsx(Oe,{children:"If set, FSH Online will display debug level messages within the console"})]}),t.jsx(Se,{children:t.jsx(N,{onClick:T,color:"primary",children:"Done"})})]}),t.jsxs(xe,{open:i,onClose:f,"aria-labelledby":"form-dialog-title",maxWidth:"lg",fullWidth:!0,scroll:"paper",classes:{paper:n.dialogPaper},children:[t.jsx(me,{id:"form-dialog-title",children:"FSH Examples"}),t.jsx(re,{children:t.jsxs(X,{container:!0,style:{overflow:"scroll",minHeight:"64vh"},children:[t.jsx(X,{item:!0,xs:4,children:t.jsx(Ut,{className:n.treeView,defaultCollapseIcon:t.jsx(at,{}),defaultExpandIcon:t.jsx(rt,{}),onNodeSelect:he,children:e.exampleConfig.map(g=>Ie(g))})}),t.jsx(X,{item:!0,xs:8,children:t.jsx(ze,{name:B?U:"",isExamples:!0,value:B,initialText:B,updateTextValue:pe,mode:"fsh",placeholder:te?"Fetching example...":"Select an example",isLineWrapped:e.isLineWrapped})})]})}),t.jsxs(Se,{className:n.dialogActions,children:[t.jsxs("div",{className:n.dialogActionsMessage,children:["Have an example that might be bene-fish-al? Seas the day and add to our collection on"," ",t.jsx(ot,{href:"https://github.com/FHIR/FSHOnline-Examples#readme",children:"GitHub"}),"!"]}),t.jsxs("div",{children:[t.jsxs(N,{onClick:ne,color:"primary",children:[t.jsx(Jt,{})," Copy to clipboard"]}),t.jsx(N,{onClick:f,color:"secondary",children:"Close"})]})]})]})]})}const Wn=ae(()=>({container:{height:"100%",flexGrow:1},fullHeightGrid:{height:"100%"},editorPane:{flexGrow:"0"},resize:{height:"100%",width:"4px",cursor:"col-resize","&:hover":{background:Je.palette.common.lightBlue}},resizeBlue:{background:"#487AA2"},resizeCursor:{cursor:"col-resize"},collapsedMain:{width:"100%",height:"calc(100vh - 116px - 300px)"},expandedMain:{width:"100%",height:"calc(100vh - 116px - 34px)"},collapsedConsole:{height:"25px",width:"100%"},expandedConsole:{height:"300px",width:"100%"},top:{height:"116px"}})),mt="https://raw.githubusercontent.com/FHIR/FSHOnline-Examples/main",_e="There are no messages to display in the console.",Xe="There are no problems to display in the console.";let we=[_e],je=[Xe],Pe=0,Ve="#FDD835",St={};console._stdout={};console.log=console._stdout.write=function(n){n&&(n.startsWith("error")||n.startsWith("warn"))&&(je[0]===Xe&&(je=[]),Pe++,je.push(n),n.startsWith("error")&&(Ve="#FD6668")),we[0]===_e&&(we=[]),we.push(n)};function yt(e){e.forEach(n=>{n.type==="category"&&yt(n.children),n.id=n.path.replaceAll("%20","-"),n.type==="file"&&(St[n.id]={path:`${mt}/Examples/${n.path}`,description:n.description,name:n.name}),delete n.type,delete n.path})}async function Gn(){let e=await fetch(`${mt}/index.json`).then(n=>n.json());return yt(e.children),[...e.children]}async function Bn(e){if(e==null||e=="")return"";if(e.length===7){const n=await fetch(`/shares/${e}`,{headers:{Accept:"application/text"}}).then(i=>i.ok?i.text():null).catch(()=>null);return n!=null?Te.inflateSync(et.from(n,"base64")).toString("utf-8"):""}else return Te.inflateSync(et.from(e,"base64")).toString("utf-8")}async function Mn(e){const n=await fetch(`https://api.github.com/gists/${e}`).then(o=>o.json());let i="";for(let o of Object.values((n==null?void 0:n.files)||{}))o.truncated?i+=await fetch(o.raw_url).then(r=>r.text()):i+=o.content,i+=`

`;return i.trim()}const Ct=h.createContext(!1);function Ge(e){const n=Wn(),i=zt(),[o,r]=h.useState(!1),[a,c]=h.useState(""),[d,s]=h.useState([""]),[u,l]=h.useState(""),[p,C]=h.useState(!1),[b,v]=h.useState(!1),[y,L]=h.useState(!1),[E,q]=h.useState([]),[Y,te]=h.useState({}),[V,B]=h.useState(41.666667),[O,U]=h.useState(!1),[m,S]=h.useState({canonical:"",version:"",fhirVersion:[],dependencies:""}),[f,I]=h.useState({}),[T,H]=h.useState(!1),[_,K]=h.useState(!1);h.useEffect(()=>{async function x(){if(e.path==="share"){const $=await Bn(i["*"]),ee=$.indexOf(`
`),R=$.slice(0,ee);let A,se=$;try{const P=JSON.parse(R);P.c!=null&&P.v!=null&&P.d!=null&&(A={canonical:P.c,version:P.v,fhirVersion:P.f||[],dependencies:P.d},se=$.slice(ee+1))}catch{}I(A||{}),l(se)}else if(e.path==="gist"){const $=await Mn(i.id);l($)}}async function k(){q(await Gn()),te(St)}x(),k()},[i,e.path]);function Z(){we=[_e],je=[Xe],Pe=0,Ve="#FDD835"}function Q(x,k,$){r(x),s(k),C($)}function le(x,k){v(k),l(x===""?null:x)}function ce(x){(u===""||u===null)&&l(x),c(x)}function de(x){s(x)}function ue(x){S(x)}function he(){B(41.666667)}function pe(x){x.preventDefault(),U(!0)}function ne(x){x.preventDefault(),U(!1)}function Ne(){U(!0)}function Ie(){U(!1)}function g(x){H(x)}function w(x){K(x)}function F(x){if(O){const k=x/window.innerWidth*100;k>10&&k<76&&B(k)}}function M(x){const k=x.clientX;O&&j.debounce(()=>F(k),10)()}function G(x){const k=x.touches[0].clientX;O&&j.debounce(()=>F(k),10)()}function J(x,k){if(k.get(x)){let $=k.get(x),ee=`${x}-${$}`;for(;k.get(ee);)$=$+1,ee=`${x}-${$}`;k.set(x,$+1),x=ee,k.set(ee,1)}else k.set(x,1);return x}function De(){const x=new Map,k=new Xt;k.file("FSH.fsh",a);const[$,ee]=j.partition(d,R=>R.id&&R.id!=="Untitled");$.forEach(R=>{let A;try{A=JSON.parse(R.def)}catch{}const se=J(A!=null&&A.resourceType?`${A.resourceType}-${R.id}`:R.id,x),P=R.def??null;k.file(`${se}.json`,P)}),ee.forEach(R=>{let A;try{A=JSON.parse(R.def)}catch{}const se=R.id??"Untitled",P=J(A.resourceType?`${A.resourceType}-${se}`:se,x),bt=R.def??null;k.file(`${P}.json`,bt)}),k.generateAsync({type:"blob"}).then(R=>{Ue.saveAs(R,"fshonline.zip")})}return t.jsx(_t,{theme:Je,children:t.jsxs("div",{className:"root",style:{height:"100vh"},children:[t.jsxs("div",{className:n.top,children:[t.jsx(tn,{}),t.jsx(On,{onSUSHIClick:Q,onGoFSHClick:le,onConfigChange:ue,config:f,fshText:a,gofshText:d,resetLogMessages:Z,exampleConfig:E,exampleMetadata:Y,isWaiting:b||p,saveAll:De,setIsLineWrapped:g,isLineWrapped:T,setIsDebugConsoleChecked:w,isDebugConsoleChecked:_})]}),t.jsx("div",{className:y?n.collapsedMain:n.expandedMain,children:t.jsx(Ct.Provider,{value:y,children:t.jsxs(X,{className:z(n.container,O&&n.resizeCursor),container:!0,onTouchMove:G,onMouseMove:M,onMouseUp:ne,onMouseLeave:ne,children:[t.jsx(X,{item:!0,className:z(n.fullHeightGrid,n.editorPane),style:{maxWidth:`calc(${V}% - 2px)`,flexBasis:`calc(${V}% - 2px)`},children:t.jsx(cn,{text:a,initialText:u,updateTextValue:ce,isWaiting:b,setInitialText:l,config:m,isLineWrapped:T})}),t.jsx(X,{item:!0,className:z(n.resize,O&&n.resizeBlue),onTouchStart:Ne,onTouchEnd:Ie,onMouseDown:pe,onDoubleClick:he}),t.jsx(X,{item:!0,className:z(n.fullHeightGrid,n.editorPane),style:{maxWidth:`calc(${100-V}% - 2px)`,flexBasis:`calc(${100-V}% - 2px)`},children:t.jsx(ln,{text:d,showNewText:o,setShowNewText:r,isWaiting:p,updateTextValue:de,isLineWrapped:T})})]})})}),t.jsx("div",{className:y?n.expandedConsole:n.collapsedConsole,children:t.jsx(un,{consoleMessages:we,problemMessages:je,problemCount:Pe,problemColor:Ve,expandConsole:y,setExpandConsole:L})})]})})}function An(){return t.jsxs(qt,{children:[t.jsx(We,{path:"/share/*",element:t.jsx(Ge,{path:"share"})}),t.jsx(We,{path:"/gist/:id",element:t.jsx(Ge,{path:"gist"})}),t.jsx(We,{path:"/*",element:t.jsx(Ge,{})})]})}Yt.render(t.jsx(Kt.StrictMode,{children:t.jsx(Zt,{basename:"/",children:t.jsx(An,{})})}),document.getElementById("root"));

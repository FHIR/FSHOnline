import{m as oe,j as t,A as bt,T as wt,B as M,S as qe,a as Xe,b as N,E as jt,c as vt,r as h,d as je,I as ve,L as It,D as pe,e as fe,f as se,g as Te,l as Ye,F as nt,h as ge,i as st,k as ye,n as We,C as kt,o as _,U as Tt,p as ot,q as Ft,s as Nt,t as Dt,u as it,v,w as Ve,x as Ht,y as $t,z as Et,G as Rt,H as rt,J as Ot,K as Ie,M as Ce,N as at,O as Lt,P as Wt,Q as lt,R as Fe,V as Gt,W as De,X as At,Y as Mt,Z as q,_ as Ke,$ as Ze,a0 as Pt,a1 as He,a2 as $e,a3 as Ee,a4 as Re,a5 as Bt,a6 as Vt,a7 as Qe,a8 as Ut,a9 as Jt,aa as zt,ab as _t,ac as qt,ad as Oe,ae as Xt,af as Yt,ag as Kt}from"./vendor-DXyL9cAa.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function s(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(r){if(r.ep)return;r.ep=!0;const a=s(r);fetch(r.href,a)}})();async function Zt(e){return fetch("https://api-ssl.bitly.com/v4/shorten",{method:"POST",body:JSON.stringify({long_url:e}),headers:{Authorization:"406592f5594d9d67f9d380d481bbba8d9d0b9827","Content-Type":"application/json"}}).then(n=>n.json()).then(n=>({link:n.link,errorNeeded:!1})).catch(()=>({link:void 0,errorNeeded:!0}))}async function Qt(e){const n=`bit.ly/${e}`;return fetch("https://api-ssl.bitly.com/v4/expand",{method:"POST",body:JSON.stringify({bitlink_id:n}),headers:{Authorization:"406592f5594d9d67f9d380d481bbba8d9d0b9827","Content-Type":"application/json"}}).then(s=>s.json()).catch(s=>console.error(s))}const en="/assets/FSH-online-logo-BTt1RVAN.png",tn=oe(e=>({root:{background:e.palette.common.blue,position:"static",boxShadow:"0"},title:{fontSize:20,fontWeight:700},logo:{height:"55px",width:"63px"},toolbarBox:{alignItems:"center"},exitIcon:{paddingLeft:"3px",transform:"scaleX(-1)"},docButton:{color:e.palette.common.white,backgroundColor:e.palette.common.blue,fontSize:"0.875rem",fontWeight:700,"&:hover":{background:e.palette.common.lightBlue}},versionText:{color:e.palette.common.white,fontSize:"0.8rem",fontStyle:"italic",marginTop:"-5px"}}));function nn(){const e=tn();return t.jsx(bt,{className:e.root,children:t.jsx(wt,{children:t.jsxs(M,{className:e.toolbarBox,display:"flex",flexGrow:1,flexDirection:"row",children:[t.jsxs(M,{order:1,display:"flex",flexGrow:1,flexDirection:"row",children:[t.jsx(M,{order:1,alignSelf:"center",display:"flex",children:t.jsx("img",{src:en,alt:"logo",className:e.logo})}),t.jsx(M,{order:2,alignSelf:"center",m:1,children:t.jsxs(qe,{injectFirst:!0,children:[t.jsx(Xe,{order:1,className:e.title,children:"FSH ONLINE"}),t.jsx(Xe,{order:2,className:e.versionText,children:"Powered by SUSHI v3.12.0 and GoFSH v2.3.1"})]})})]}),t.jsx(M,{order:1,children:t.jsx(qe,{injectFirst:!0,children:t.jsxs(N,{className:e.docButton,href:"https://fshschool.org/",target:"_blank",children:[t.jsx(jt,{className:e.exitIcon,fontSize:"small"}),"Back to School"]})})})]})})})}const te={lighterBlue:"#D8E2EA",lightBlue:"#487AA2",blue:"#30638e",darkerBlue:"#143E61",editorGrey:"#263238",lightestGrey:"#E7ECEE",lightGrey:"#D0D9DD",grey:"#575B5C",darkerGrey:"#3D4345",darkestGrey:"#121D21",red:"#FD6668"},Ue=vt({palette:{success:{main:te.blue,dark:te.darkerBlue,light:te.lightBlue},common:te},typography:{fontFamily:"Open Sans"},overrides:{MuiTooltip:{tooltip:{backgroundColor:te.darkestGrey,fontSize:"13px"},arrow:{color:te.darkestGrey}},MuiButton:{text:{textTransform:"none",fontWeight:600}},MuiIconButton:{root:{"&:hover":{backgroundColor:te.grey}}}}}),sn=oe(e=>({iconButton:{color:e.palette.common.white,padding:"3px"},textArea:{width:"100%",color:e.palette.text.primary,fontWeight:"bold"},copyBox:{backgroundColor:e.palette.common.lightGrey,borderRadius:2,display:"flex",justifyContent:"space-between",alignItems:"center",paddingLeft:"3%",textOverflow:"ellipsis"}}));function on(e){const n=sn(),[s,o]=h.useState(!1),[r,a]=h.useState(!1),[c,d]=h.useState(!1),[i,u]=h.useState(!1),[l,p]=h.useState("Copy to Clipboard"),[{fshCopied:C,fshCopyButton:b},w]=h.useState({fshCopied:!1,fshCopyButton:"Copy FSH to Clipboard"}),[y,O]=h.useState(),[L,X]=h.useState(),[Z,Q]=h.useState(!0),U=D=>{var Y;const G=(Y=D.target.value.match(/gist\.github\.com\/[^/]+\/(.+)/))==null?void 0:Y[1];G&&X(`https://fshonline.fshschool.org/#/gist/${G}`)},J=()=>{a(!0),E()},E=()=>{o(!1),d(!0),X(""),w({fshCopied:!1,fshCopyButton:"Copy FSH to Clipboard"})},W=()=>{d(!1),a(!1)},m=()=>{L?(W(),O(L),o(!0),p("Copy to Clipboard"),Q(!1)):u(!0)},S=()=>{u(!1)},g=async()=>{var ie,re,ae,le,ce,de,ue,he;let D;(ie=e.config)!=null&&ie.canonical||(re=e.config)!=null&&re.version||((ae=e.config)==null?void 0:ae.fhirVersion.length)>0||(le=e.config)!=null&&le.dependencies?D=We.deflateSync(JSON.stringify({c:(ce=e.config)==null?void 0:ce.canonical,v:(de=e.config)==null?void 0:de.version,f:(ue=e.config)==null?void 0:ue.fhirVersion,d:(he=e.config)==null?void 0:he.dependencies})+`
`+e.shareText).toString("base64"):D=We.deflateSync(e.shareText).toString("base64");const G=`https://fshonline.fshschool.org/#/share/${D}`,Y=await Zt(G);if(Y.errorNeeded===!0)J();else{const me=`https://fshonline.fshschool.org/#/share/${Y.link.slice(15)}`;O(me),o(!0),p("Copy to Clipboard"),Q(!0)}},I=()=>{o(!1),a(!1)},T=()=>{w({fshCopied:!0,fshCopyButton:"FSH Copied to Clipboard"})};return t.jsxs(t.Fragment,{children:[t.jsx(je,{title:"Share FSH",placement:"top",arrow:!0,children:t.jsx(ve,{name:"Share FSH",className:n.iconButton,onClick:g,children:t.jsx(It,{fontSize:"small",style:{transform:"rotate(-45deg)"}})})}),t.jsxs(pe,{open:s,onClose:I,"aria-labelledby":"form-dialog-title",maxWidth:"md",fullWidth:!0,children:[t.jsx(fe,{id:"form-dialog-title",children:"Share"}),t.jsxs(se,{children:[t.jsx(Te,{children:"Use this link to share your FSH with others!"}),t.jsxs(M,{className:n.copyBox,children:[t.jsx(M,{maxWidth:"90%",textOverflow:"ellipsis",overflow:"hidden",children:y}),t.jsx(je,{title:l,placement:"top",arrow:!0,children:t.jsx(Ye.CopyToClipboard,{text:y,onCopy:()=>p("Link Copied"),children:t.jsx(ve,{style:{borderRadius:"0%"},children:t.jsx(nt,{})})})})]})]}),t.jsxs(ge,{children:[Z&&t.jsx(N,{onClick:E,color:"primary",style:{align:"left"},children:"Create Link with Gist"}),t.jsx(M,{style:{flex:"1 0 0",hidden:!0}}),t.jsx(N,{onClick:I,color:"primary",children:"Done"})]})]}),t.jsxs(pe,{open:c,onClose:W,"aria-labelledby":"alert-dialog-title",maxWidth:"md",fullWidth:!0,children:[t.jsx(fe,{id:"alert-dialog-title",children:"Share with Gist"}),r&&t.jsx(se,{style:{color:Ue.palette.common.red},children:"Your FSH content is too long to share directly. Please use a Gist to share."}),t.jsxs(se,{children:["Create a"," ",t.jsx(st,{id:"gistURL",href:"https://gist.github.com/",target:"_blank",children:"Gist"})," ","and paste the URL below to generate a shareable FSH Online link.",t.jsx(ye,{id:"gistURLText",label:"Gist URL",fullWidth:!0,onChange:U})]}),t.jsxs(ge,{style:{bottom:0,right:0},children:[t.jsx(N,{onClick:W,color:"primary",children:"Cancel"}),t.jsx(M,{style:{flex:"1 0 0",hidden:!0}}),t.jsx(Ye.CopyToClipboard,{text:e.shareText,onCopy:T,style:{align:"left"},children:t.jsx(N,{color:C?"secondary":"primary",children:b})}),t.jsx(N,{color:"primary",onClick:m,style:{align:"left"},children:"Generate Link from Gist"})]})]}),t.jsxs(pe,{open:i,onClose:S,"aria-labelledby":"alert-dialog-title",maxWidth:"lg",children:[t.jsx(fe,{id:"alert-dialog-title",children:"Error Creating Gist Link"}),t.jsx(se,{children:t.jsx(Te,{children:"Could not generate a link from your Gist URL. Ensure the URL is valid."})}),t.jsx(ge,{children:t.jsx(N,{onClick:S,color:"primary",children:"Keep Swimming!"})})]})]})}kt.defineSimpleMode("fsh",{meta:{lineComment:"//"},start:[{regex:/"(?:[^\\]|\\.)*?(?:"|$)/,token:"atom"},{regex:/\b(Alias|Characteristics|Context|CodeSystem|Expression|Extension|Description|Id|Instance|InstanceOf|Invariant|Logical|Mapping|Mixins|Parent|Profile|Resource|RuleSet|Severity|Source|Target|Title|Usage|ValueSet|XPath)(?=\s*:)\b/,token:"keyword"},{regex:/(\s|^)(and|codes|contains|descendent-of|exclude|exists|from system|from|generalizes|include|in|insert|is-a|is-not-a|named|not-in|obeys|only|or|regex|units|valueset|where|D|MS|N|SU|TU|\\?!)(\s|$)/,token:"def"},{regex:/(\(\s*)(exactly|example|extensible|preferred|required)(\s*\))/,token:"def"},{regex:/\b(CodeableReference|Reference|Canonical)\s*\(/,push:"closingParen",token:"atom"},{regex:/\*|->|=|\+|:/,token:"def"},{regex:/\b(https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_+.~#?&//=]*))\b/,token:"atom"},{regex:/(\s|^)(true|false)(\s|$)/,token:"string"},{regex:/(\s|^)(-?\d+(\.\d+)?)(\s|^)/,token:"string"},{regex:/#"(?:\\.|[^\\"])*"/,token:"string"},{regex:/#[^\s]*/,token:"string"},{regex:/'.*'/,token:"string"},{regex:/\s\/\/.*/,token:"comment"},{regex:/\/\/.*/,token:"comment",sol:!0},{regex:/\/\*/,token:"comment",next:"comment"}],closingParen:[{regex:/\)/,pop:!0,token:"atom"}],comment:[{regex:/.*?\*\//,token:"comment",next:"start"},{regex:/.*/,token:"comment"}]});const Se=200,rn=oe(e=>({box:{height:"100%"},header:{fontFamily:"Open Sans",color:e.palette.common.white,background:e.palette.common.darkerGrey,padding:"0px",paddingLeft:"29px",height:"34px",display:"flex",justifyContent:"space-between",transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},headerShift:{width:`calc(100% - ${Se}px - 29px)`,transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginRight:Se},headerLabel:{lineHeight:"34px",float:"left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},headerActionGroup:{paddingRight:"10px"},headerActions:{alignItems:"center",display:"flex"},iconButton:{color:e.palette.common.white,padding:"3px"},drawer:{width:Se,flexShrink:0},drawerPaper:{width:Se,border:"none",height:"calc(100vh - 116px - 34px)",top:"116px"},drawerPaperExpandedConsole:{height:"calc(100vh - 116px - 300px)"},drawerHeader:{display:"flex",alignItems:"center",justifyContent:"flex-start",color:e.palette.common.white,background:e.palette.common.darkerGrey,height:"34px",minHeight:"34px"},drawerHeaderIcon:{padding:"0px",color:e.palette.common.white,background:e.palette.success.main,"&:hover":{background:e.palette.success.light},borderRadius:0,height:"100%",width:"34px",minWidth:"34px"},content:{flexGrow:1,width:"100%",transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},contentShift:{width:`calc(100% - ${Se}px)`,transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginRight:0}}));function Je(e){const n=rn(),s=h.useContext(yt),[o,r]=h.useState(!0),a=()=>{r(!0)},c=()=>{r(!1)};function d(p){e.updateTextValue(p)}const i=(p,C,b,w={})=>t.jsx(je,{title:v.upperFirst(C),placement:"top",arrow:!0,children:t.jsx(ve,{name:C,className:n.iconButton,"aria-label":C,onClick:b,children:t.jsx(p,{fontSize:"small",style:w})})}),u=()=>t.jsxs("div",{className:n.headerActions,children:[t.jsxs("div",{className:n.headerActionGroup,children:[e.mode==="fsh"&&!e.isExamples&&t.jsx(on,{shareText:e.value,config:e.config}),e.copy&&i(nt,"copy",()=>{}),e.save&&i(ot,"save",e.save),e.delete&&i(Ft,"delete",e.delete)]}),e.renderDrawer&&!o&&t.jsx(ve,{name:"expand",className:n.drawerHeaderIcon,"aria-label":"expand",onClick:a,children:t.jsx(Nt,{})})]}),l=()=>t.jsxs(Dt,{className:n.drawer,"data-testid":"editor-drawer",variant:"persistent",anchor:"right",open:o,classes:{paper:_(n.drawerPaper,s&&n.drawerPaperExpandedConsole)},children:[t.jsx("div",{className:n.drawerHeader,children:t.jsx(N,{name:"collapse","aria-label":"collapse",className:n.drawerHeaderIcon,onClick:c,children:t.jsx(it,{})})}),e.renderDrawer()]});return t.jsxs(M,{className:n.box,children:[t.jsxs("div",{className:_(n.header,{[n.headerShift]:e.renderDrawer&&o}),children:[t.jsx("div",{title:e.name,className:n.headerLabel,children:e.name}),u()]}),t.jsx(Tt,{className:_("react-codemirror2",e.renderDrawer&&n.content,{[n.contentShift]:e.renderDrawer&&o}),value:e.initialText,options:{mode:e.mode,theme:"material",placeholder:e.placeholder,scrollbarStyle:"overlay",autoCloseBrackets:!0,lineNumbers:!0,foldGutter:!0,readOnly:e.isExamples,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],extraKeys:{Tab:p=>{p.replaceSelection("  ")},"Ctrl-/":"toggleComment","Cmd-/":"toggleComment","Ctrl-Q":p=>{p.foldCode(p.getCursor())}},lineWrapping:e.isLineWrapped},onChange:(p,C,b)=>{d(b)}}),e.renderDrawer&&l()]})}function ct(e){return t.jsxs(pe,{open:e.isOpen,onClose:e.handleCloseModal,"aria-labelledby":"delete-confirmation-dialog",children:[t.jsxs(fe,{id:"delete-confirmation-dialog-title",children:["Delete ",e.title]}),t.jsx(se,{children:t.jsxs(Te,{children:["Are you sure you want to delete ",e.item,"? This action cannot be undone."]})}),t.jsxs(ge,{children:[t.jsx(N,{onClick:e.handleCloseModal,color:"primary",children:"Cancel"}),t.jsx(N,{onClick:e.handleDelete,color:"secondary",children:"Delete"})]})]})}const an=oe(e=>({fileTreeContent:{overflowY:"scroll",height:"100%"},button:{color:e.palette.common.white,background:e.palette.success.main,"&:hover":{background:e.palette.success.dark},border:"8px solid white",fontSize:"13px",width:"100%"},list:{padding:"8px",paddingLeft:"0px",paddingBottom:"0px",fontSize:"13px"},listItemError:{paddingTop:"5px",paddingBottom:"5px",margin:0},listItem:{background:e.palette.common.lightestGrey,paddingTop:"5px",paddingBottom:"5px",marginTop:"5px",marginBottom:"5px",paddingLeft:"5px",margin:0,"&:hover":{background:e.palette.common.lightGrey},display:"block",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},listItemSelected:{background:e.palette.common.editorGrey,color:e.palette.common.white,"&:hover":{background:e.palette.common.darkestGrey}},listHeader:{padding:"5px",paddingLeft:"15px"},listIcon:{color:e.palette.success.main,verticalAlign:"middle",fontSize:"13px",paddingLeft:"3px",paddingRight:"3px"},listIconError:{color:e.palette.common.red},blankIcon:{paddingLeft:"19px"}})),Ge=e=>{if(e.resourceType==="ValueSet"||e.resourceType==="CodeSystem")return e.resourceType;if(e.resourceType==="StructureDefinition"){if(e.derivation==="specialization"){if(e.kind==="resource")return"Resource";if(e.kind==="logical")return"Logical Model"}else if(e.derivation==="constraint"){if(e.kind==="complex-type"&&e.type==="Extension")return"Extension";if(["resource","complex-type","primitive-type","logical"].includes(e.kind))return"Profile"}}return e.resourceType!=null?"Instance":null},Ae=e=>{if(e.id)if(typeof e.id=="object"){if(e.id.value)return e.id.value}else return e.id;return e.resourceType?`Instance of ${e.resourceType.substring(e.resourceType.lastIndexOf("/")+1)}`:"Untitled"},ln=e=>[...e.profiles,...e.extensions,...e.logicals,...e.resources,...e.instances,...e.valueSets,...e.codeSystems].map(s=>({resourceType:Ge(s),id:Ae(s),def:JSON.stringify(s,null,2)}));function cn(e){const n=an(),[s,o]=h.useState(""),[r,a]=h.useState([{resourceType:null,id:"Untitled",def:null}]),{setShowNewText:c,updateTextValue:d}=e,[i,u]=h.useState(0),[l,p]=h.useState([]),[C,b]=h.useState(!1);h.useEffect(()=>{if(e.showNewText&&!v.isEqual(e.text,[""])){c(!1);let m;try{m=JSON.parse(e.text)}catch{m={profiles:[],extensions:[],logicals:[],resources:[],instances:[],valueSets:[],codeSystems:[]}}const S=ln(m);a(S),u(0),o(S.length>0?S[0].def:""),d(S)}else e.isWaiting&&(o(null),a([]))},[e.text,e.showNewText,e.isWaiting,d,c]);const w=m=>{if(e.isWaiting)return;const S=[...r];try{const g=m===""?{}:JSON.parse(m);if(l.includes(i)){const I=[...l];I.splice(l.indexOf(i),1),p(I)}r[i]||(S[i]={resourceType:Ge(g),id:Ae(g)}),(!r[i]||g.resourceType!==r[i].resourceType)&&(S[i].resourceType=Ge(g)),(!r[i]||g.id!==r[i].id)&&(S[i].id=Ae(g))}catch{if(!l.includes(i)){const I=[...l];I.push(i),p(I)}}S[i]&&(S[i].def=m),a(S),e.updateTextValue(S),s===null&&o(m)},y=()=>{const m=[...r];m.push({resourceType:null,id:"Untitled",def:null}),u(m.length-1),a(m),o(null),e.updateTextValue(m)},O=()=>{const m=i,S=[...r];if(S.splice(m,1),S.length===0&&S.push({resourceType:null,id:"Untitled",def:null}),a(S),m<=i){let T=0;m<i&&(T=i-1),u(T);const D=S.length>0?S[T].def:null;o(D)}const g=[...l];l.includes(m)&&g.splice(l.indexOf(m),1);const I=g.map(T=>T<m?T:T-1);p(I),b(!1),e.updateTextValue(S)},L=()=>{b(!0)},X=()=>{b(!1)},Z=(m,S)=>{let g;try{g=JSON.parse(m)}catch{}Ve.saveAs(new Blob([m]),g!=null&&g.resourceType&&(g!=null&&g.id)?`${g.resourceType}-${g.id}.json`:`${S}.json`)},Q=()=>{const m=r[i];if(!m)return;const S=m.resourceType||"Unknown Type",g=m.id||"Untitled";return t.jsx(ct,{title:"FHIR JSON",item:`${S} ${g}`,isOpen:C,handleCloseModal:X,handleDelete:O})},U=()=>{const m=["Profiles","Extensions","Logical Models","Resources","ValueSets","CodeSystems","Instances","Unknown Type"],S=v.groupBy(r,g=>g&&g.resourceType?`${g.resourceType}s`:"Unknown Type");return Object.keys(S).sort((g,I)=>m.indexOf(g)-m.indexOf(I)).map(g=>t.jsxs($t,{component:"nav",className:n.list,children:[t.jsx("div",{className:n.listHeader,children:g}),S[g].sort((I,T)=>{const D=I.id?I.id:"Untitled",G=T.id?T.id:"Untitled";return D.toLowerCase()<G.toLowerCase()?-1:D.toLowerCase()>G.toLowerCase()?1:0}).map((I,T)=>{const D=r.indexOf(I),G=l.includes(D);return t.jsxs(Et,{button:!0,title:(I==null?void 0:I.id)||"Untitled","data-testid":`${g}-defId`,className:_(n.listItem,G&&n.listItemError,D===i&&n.listItemSelected),onClick:()=>{u(D),o(I.def)},children:[l.includes(D)?t.jsx(je,{title:"Invalid JSON",placement:"top",arrow:!0,children:t.jsx(Rt,{className:_(n.listIcon,n.listIconError)})}):t.jsx("span",{className:n.blankIcon}),(I==null?void 0:I.id)||"Untitled"]},T)})]},g))},J=()=>t.jsxs(t.Fragment,{children:[t.jsx(N,{className:n.button,startIcon:t.jsx(Ht,{}),onClick:y,children:"New JSON Editor"}),t.jsx("div",{className:n.fileTreeContent,children:U()})]}),E=r.length>0?r[i].def:null,W=`${r.length>0?r[i].id:"Untitled"}`;return t.jsxs(t.Fragment,{children:[t.jsx(Je,{name:`FHIR JSON: ${W}`,value:E,initialText:s,updateTextValue:w,mode:"application/json",placeholder:e.isWaiting?"Loading...":`Paste or edit single FHIR JSON artifact here... 
Create additional FHIR JSON artifacts to the right.`,renderDrawer:J,isExamples:!1,delete:L,save:()=>Z(E,W),isLineWrapped:e.isLineWrapped}),C&&Q()]})}function dn(e){const[n,s]=h.useState(!1),o=()=>{s(!n)},r=()=>{s(!1),e.setInitialText("")},a=()=>{Ve.saveAs(new Blob([e.text]),"FSH.fsh")};return t.jsxs(t.Fragment,{children:[t.jsx(Je,{name:"FSH",isExamples:!1,value:e.text,initialText:e.initialText,updateTextValue:e.updateTextValue,mode:"fsh",placeholder:e.isWaiting?"Loading...":"Paste or edit FSH here...",delete:o,save:a,config:e.config,isLineWrapped:e.isLineWrapped}),n&&t.jsx(ct,{title:"FHIR Shorthand",item:"all FSH",isOpen:n,handleCloseModal:o,handleDelete:r})]})}const un=oe(e=>({consoleControls:{background:e.palette.common.darkestGrey,height:"34px",boxSizing:"border-box",display:"flex;",alignItems:"center",justifyContent:"left"},box:{paddingLeft:"29px",color:e.palette.common.white,background:e.palette.common.darkestGrey,height:"calc(100% - 34px)",overflow:"scroll",boxSizing:"border-box"},button:{marginRight:"10px",color:e.palette.common.white,textTransform:"none",padding:0},problemsButton:{padding:0,color:e.palette.common.white,textTransform:"none"},expandIcon:{width:"29px",color:e.palette.common.white,padding:0},pre:{margin:"0px"},circle:{"border-radius":"50%","border-style":"solid","border-width":"2px","min-width":"20px",height:"20px",paddingLeft:1,paddingRight:1,background:"#263238","align-items":"center",display:"flex",marginLeft:4,"justify-content":"center",padding:0}}));function hn(e){const n=un(),[s,o]=h.useState(!1),{problemCount:r,setExpandConsole:a}=e;h.useEffect(()=>{r&&a(!0)},[r,a]);const c=()=>{e.setExpandConsole(!e.expandConsole)},d=()=>{o(!1),e.setExpandConsole(!0)},i=()=>{o(!0),e.setExpandConsole(!0)};return t.jsxs(t.Fragment,{children:[t.jsxs(M,{className:n.consoleControls,children:[t.jsx(ve,{onClick:c,"aria-label":e.expandConsole?"collapse console":"expand console",className:n.expandIcon,children:e.expandConsole?t.jsx(rt,{}):t.jsx(Ot,{})}),t.jsx(N,{onClick:d,className:n.button,children:t.jsx("p",{style:{borderBottom:e.expandConsole&&!s?"1px solid white":"none",margin:"0"},children:"Console"})}),t.jsxs(N,{onClick:i,className:n.problemsButton,children:[t.jsx("p",{style:{borderBottom:e.expandConsole&&s?`1px solid ${e.problemCount?e.problemColor:"white"}`:"none",margin:"0"},children:"Problems"}),t.jsx("div",{className:n.circle,style:{borderColor:`${e.problemCount?e.problemColor:"white"}`},children:e.problemCount})]})]}),t.jsx(M,{style:{display:e.expandConsole?"block":"none"},className:n.box,children:s?e.problemMessages.map((u,l)=>t.jsx("pre",{className:n.pre,children:u},l)):e.consoleMessages.map((u,l)=>t.jsx("pre",{className:n.pre,children:u},l))})]})}let H=Ie.logger;function dt(e,n){e==="sushi"?H=Ie.logger:e==="gofsh"&&(H=Ce.logger),H.level=n}function pn(e,n,s){let o={resourceArr:e,emptyDependencies:[]};return new Promise(r=>{at.get(`https://packages.fhir.org/${n}/${s}`,function(a){const c=Lt.extract();c.on("entry",function(d,i,u){let l="";i.on("data",function(p){l+=p.toString()}),i.on("end",function(){try{const p=JSON.parse(l);p.resourceType&&o.resourceArr.push(p)}catch{}u()}),i.resume()}),c.on("finish",function(){r(o)}),a.statusCode<400?(a.pipe(Wt.createGunzip()).pipe(c),H.info(`Downloaded ${n}#${s}`)):(s==="current"||s==="dev"?H.error('FSHOnline does not currently support "current" or "dev" package versions'):(H.error(`Your dependency ${n}#${s} could not be loaded. Your output may be invalid.`),o.emptyDependencies.push(`${n}${s}`)),r(o))}).on("error",a=>{H.error("An error occurred while downloading FHIR packages. Your output may be invalid: ",a),o.emptyDependencies.push(`${n}${s}`),r(o)})})}function fn(e,n,s,o){return new Promise((r,a)=>{const c=e.transaction([`${s}${o}`],"readwrite");c.oncomplete=()=>{r()},c.onerror=i=>{a(i)};const d=c.objectStore(`${s}${o}`,{keyPath:["id","resourceType"]});n.forEach(i=>{i.id&&i.resourceType&&d.put(i)})})}function gn(e,n,s,o){return new Promise((r,a)=>{let c=!1;const d=n.transaction([`${s}${o}`],"readonly").objectStore(`${s}${o}`,{keyPath:["id","resourceType"]}).openCursor();d.onerror=function(){a("There is an error getting data out!")},d.onsuccess=function(){const i=d.result;i?(c=!0,e.add(i.value),i.continue()):(c&&H.info(`Loaded package ${s}#${o}`),r(e))}})}function xn(e){return new Promise((n,s)=>{const{packageId:o,isAutomatic:r}=e;at.get(`https://packages.fhir.org/${o}`,function(a){let c="";a.on("data",function(d){c+=d}),a.on("end",function(){var i,u;const d=JSON.parse(c);(u=(i=d==null?void 0:d["dist-tags"])==null?void 0:i.latest)!=null&&u.length?n(d["dist-tags"].latest):(H.error(`Could not determine latest released version of ${r?"automatically-loaded dependency ":""}${o}.`),s("no latest version found"))})})})}const mn=lt.FHIRDefinitions,Sn=Fe.FSHTank,yn=Fe.importText;function Cn(e,n){H.info("Importing FSH text...");const s=yn(e);return new Sn(s,n)}async function ut(e,n){n=await jn(n);let s=await wn(n),o={defs:e,emptyDependencies:[]};return s.shouldUpdate?(o=await et(e,s.version+1,n),e=o.defs):(o=await et(e,s.version,n),e=o.defs),await bn(o.emptyDependencies,s.version+2),e}function bn(e,n,s="FSH Playground Dependencies"){const o=v.flatten(e);return new Promise((r,a)=>{let c=null;const d=indexedDB.open(s,n);d.onsuccess=function(i){c=i.target.result,c.close(),r()},d.onupgradeneeded=async function(i){c=i.target.result;let u=c.objectStoreNames;for(let l of u)await new Promise(p=>{const b=i.target.transaction.objectStore(`${l}`).getAll();b.onsuccess=w=>{w.target.result.length===0&&!o.includes(l)&&o.push(l),p()}});for(let l=0;l<o.length;l++)u.contains(o[l])&&c.deleteObjectStore(o[l])},d.onerror=function(i){a(i)}})}function wn(e,n="FSH Playground Dependencies"){let s={shouldUpdate:!1,version:1};return new Promise((o,r)=>{let a=null;const c=indexedDB.open(n);c.onsuccess=function(d){a=d.target.result;let i=a.objectStoreNames;s.version=a.version,i.length===0||e.length===0||i.contains("resources")?(s.shouldUpdate=!0,a.close(),o(s)):(e.forEach(u=>{const{packageId:l,version:p}=u;i.contains(`${l}${p}`)||(s.shouldUpdate=!0)}),a.close(),o(s))},c.onupgradeneeded=function(d){a=d.target.result},c.onerror=function(d){r(d)}})}async function et(e,n,s,o="FSH Playground Dependencies",r=!1){return new Promise((a,c)=>{let d=null,i=[],u={defs:mn,emptyDependencies:[]};const l=indexedDB.open(o,n);l.onsuccess=async function(p){d=p.target.result;for(let C=0;C<s.length;C++){let b=[];r=!1;const{packageId:w,version:y}=s[C];if(i.includes(`${w}${y}`)&&(r=!0),r){let O=await pn(b,w,y);O.emptyDependencies.length!==0&&u.emptyDependencies.push(O.emptyDependencies),await fn(d,O.resourceArr,w,y)}u.defs=await gn(e,d,w,y)}d.close(),a(u)},l.onupgradeneeded=function(p){d=p.target.result;let C=d.objectStoreNames;C.contains("resources")&&d.deleteObjectStore("resources");for(let b=0;b<s.length;b++){const{packageId:w,version:y}=s[b];C.contains(`${w}${y}`)||(d.createObjectStore(`${w}${y}`,{keyPath:["id","resourceType"]}),i.push(`${w}${y}`))}},l.onerror=function(p){c(p)}})}async function jn(e){return(await Promise.all(e.map(async o=>vn(o)))).filter(o=>o.version!==null)}async function vn(e){const{packageId:n,version:s}=e;let o=s;return s==="latest"&&await xn(e).then(r=>{o=r}).catch(()=>{o=null}),{packageId:n,version:o}}function ht(e){return e.split(",").map(s=>{const o=s.trim();if(o==="")return o;const[r,a]=o.split("#");return{packageId:r,version:a}}).filter(s=>s)}const In=Fe.FSHTank,kn=Fe.RawFSH,Tn=Gt.exportFHIR,Me=Ie.stats,ne=Ce.stats,pt=Ie.getRandomPun,Fn=Ie.Type,ft=lt.FHIRDefinitions;async function Nn(e,n,s){ne.reset(),dt("gofsh",s);const o=[];e.forEach((y,O)=>{const L=`Input_${O}`;try{y=JSON.parse(y),y.resourceType||H.error(`FHIR JSON ${y.id??L} is missing the required "resourceType" property`)}catch{H.error(`Could not parse ${L} to JSON`);return}Ce.isProcessableContent(y,L)&&o.push(new De.WildFHIR({content:y},L))});const r=new De.LakeOfFHIR(o);let a=new ft;const c=new Ce.MasterFisher(r,a),d=new De.FHIRProcessor(r,c),i=n.dependencies.map(y=>y.replace("#","@")),u=d.processConfig(i??[]);let l=u!=null&&u.config.dependencies?u==null?void 0:u.config.dependencies.map(y=>`${y.packageId}#${y.version}`):[];l=ht(l.join(","));const p=(u==null?void 0:u.config.fhirVersion[0])??"4.0.1",C=gt(l,p);l.push(...C),a=await ut(a,l);const b=await Ce.getResources(d,u,{indent:n.indent}),w=new At.FSHExporter(b).apiExport("string");return H.info("Done converting definitions"),$n(b),{fsh:w,config:(u==null?void 0:u.config)??{}}}async function Dn(e,n,s=[],o){Me.reset(),dt("sushi",o);let r=new ft;const a=gt(s,n.fhirVersion[0]);s.push(...a),r=await ut(r,s);let c=In;try{const l=[new kn(e)];c=Cn(l,n)}catch{H.error("Something went wrong when importing the FSH definitions");return}const d=r.fishForFHIR("StructureDefinition",Fn.Resource);if((d==null?void 0:d.version)!==n.fhirVersion[0]){H.error("StructureDefinition resource not found. The FHIR package in the browser cache may be corrupt. Clear cookies and site data on this webpage to reload the FHIR package.");return}H.info("Converting FSH to FHIR resources...");const i=Tn(c,r),u=i.profiles.length+i.extensions.length+i.logicals.length+i.resources.length+i.instances.filter(l=>l._instanceMeta.usage!=="Inline").length+i.valueSets.length+i.codeSystems.length;return H.info(`Exported ${u} FHIR resources as JSON.`),console.log(" "),Hn(i),i.profiles=i.profiles.map(l=>l.toJSON(!1)),i.extensions=i.extensions.map(l=>l.toJSON(!1)),i.logicals=i.logicals.map(l=>l.toJSON(!1)),i.resources=i.resources.map(l=>l.toJSON(!1)),i.instances=i.instances.filter(l=>l._instanceMeta.usage!=="Inline"),i}function Hn(e){const n=Me.numError,s=Me.numWarn,o=v.pad(e.profiles.length.toString(),13),r=v.pad(e.extensions.length.toString(),12),a=v.pad(e.logicals.length.toString(),12),c=v.pad(e.resources.length.toString(),13),d=v.pad(e.valueSets.length.toString(),18),i=v.pad(e.codeSystems.length.toString(),17),u=v.pad(e.instances.length.toString(),18),l=v.pad(`${n} Error${n!==1?"s":""}`,13),p=v.padStart(`${s} Warning${s!==1?"s":""}`,12),C=v.padEnd(pt(n,s),36);["╔════════════════════════ SUSHI RESULTS ══════════════════════════╗","║ ╭───────────────┬──────────────┬──────────────┬───────────────╮ ║","║ │    Profiles   │  Extensions  │   Logicals   │   Resources   │ ║","║ ├───────────────┼──────────────┼──────────────┼───────────────┤ ║",`║ │ ${o} │ ${r} │ ${a} │ ${c} │ ║`,"║ ╰───────────────┴──────────────┴──────────────┴───────────────╯ ║","║ ╭────────────────────┬───────────────────┬────────────────────╮ ║","║ │      ValueSets     │    CodeSystems    │     Instances      │ ║","║ ├────────────────────┼───────────────────┼────────────────────┤ ║",`║ │ ${d} │ ${i} │ ${u} │ ║`,"║ ╰────────────────────┴───────────────────┴────────────────────╯ ║","║                                                                 ║","╠═════════════════════════════════════════════════════════════════╣",`║ ${C} ${l} ${p} ║`,"╚═════════════════════════════════════════════════════════════════╝"].forEach(w=>console.log(w))}function $n(e){const n=v.pad(e.profiles.length.toString(),18),s=v.pad(e.extensions.length.toString(),17),o=v.pad(e.logicals.length.toString(),18),r=v.pad(e.resources.length.toString(),18),a=v.pad(e.valueSets.length.toString(),17),c=v.pad(e.codeSystems.length.toString(),18),d=v.pad(e.instances.length.toString(),18),i=v.pad(e.invariants.length.toString(),17),u=v.pad(e.mappings.length.toString(),18),l=v.pad(`${ne.numError} Error${ne.numError!==1?"s":""}`,12),p=v.padStart(`${ne.numWarn} Warning${ne.numWarn!==1?"s":""}`,12),C=v.padEnd(pt(ne.numError,ne.numWarn),37),b=["╔═════════════════════════ GoFSH RESULTS ═════════════════════════╗","║ ╭────────────────────┬───────────────────┬────────────────────╮ ║","║ │      Profiles      │    Extensions     │      Logicals      │ ║","║ ├────────────────────┼───────────────────┼────────────────────┤ ║",`║ │ ${n} │ ${s} │ ${o} │ ║`,"║ ╰────────────────────┴───────────────────┴────────────────────╯ ║","║ ╭────────────────────┬───────────────────┬────────────────────╮ ║","║ │     Resources      │     ValueSets     │     CodeSystems    │ ║","║ ├────────────────────┼───────────────────┼────────────────────┤ ║",`║ │ ${r} │ ${a} │ ${c} │ ║`,"║ ╰────────────────────┴───────────────────┴────────────────────╯ ║","║ ╭────────────────────┬───────────────────┬────────────────────╮ ║","║ │     Instances      │    Invariants     │      Mappings      │ ║","║ ├────────────────────┼───────────────────┼────────────────────┤ ║",`║ │ ${d} │ ${i} │ ${u} │ ║`,"║ ╰────────────────────┴───────────────────┴────────────────────╯ ║","║                                                                 ║","╠═════════════════════════════════════════════════════════════════╣",`║ ${C} ${l} ${p} ║`,"╚═════════════════════════════════════════════════════════════════╝"];console.log(" "),b.forEach(w=>console.log(w))}function gt(e,n){const s=[],o={packageId:En(n),version:n};return tt(e,o)||s.push(o),Rn.filter(a=>a.fhirVersions==null||a.fhirVersions.some(c=>o.version.startsWith(c))).forEach(a=>{const c={packageId:a.packageId,version:a.version,isAutomatic:!0};tt(e,c,!0)||s.push(c)}),s}function tt(e,n,s=!1){return e.some(o=>o.packageId===n.packageId&&(s||o.version===n.version))}function En(e){return/^4\.0\.1$/.test(e)?"hl7.fhir.r4.core":/^4\.3\.\d+$/.test(e)?"hl7.fhir.r4b.core":/^5\.0\.\d+$/.test(e)?"hl7.fhir.r5.core":"hl7.fhir.r4.core"}const Rn=[{packageId:"hl7.fhir.uv.tools",version:"latest"},{packageId:"hl7.terminology.r4",version:"latest",fhirVersions:["4.0","4.3"]},{packageId:"hl7.terminology.r5",version:"latest",fhirVersions:["5.0"]},{packageId:"hl7.fhir.uv.extensions.r4",version:"latest",fhirVersions:["4.0","4.3"]},{packageId:"hl7.fhir.uv.extensions.r5",version:"latest",fhirVersions:["5.0"]}],On=oe(e=>({box:{padding:e.spacing(1),color:e.palette.text.primary,background:e.palette.background.paper,display:"flex;",alignItems:"center",justifyContent:"center"},rightControls:{position:"absolute",right:"24px"},leftControls:{position:"absolute",left:"28px"},secondaryButton:{color:e.palette.success.main,"&:hover":{background:e.palette.common.lighterBlue}},progressContainer:{width:"24px",height:"24px"},progress:{height:"1em !important",width:"1em !important",verticalAlign:"middle",color:e.palette.common.white},button:{color:e.palette.common.white,background:e.palette.success.main,borderRadius:"0",paddingRight:"15px",paddingLeft:"15px","&:hover":{background:e.palette.success.dark}},buttonLeft:{float:"right",left:"-3.33px"},buttonRight:{float:"left",right:"-0.67px"},runIcon:{padding:"0px"},dialogPaper:{maxHeight:"80vh",minHeight:"80vh"},dialogActions:{justifyContent:"space-between"},dialogActionsMessage:{fontStyle:"italic",padding:"6px 8px"}}));function Ln(e,n){if(e!=="config")return n}function Wn(e){const n=On(),[s,o]=h.useState(!1),[r,a]=h.useState(!1),[c,d]=h.useState(""),[i,u]=h.useState(""),[l,p]=h.useState(""),[C,b]=h.useState(""),[w,y]=h.useState(!1),[O,L]=h.useState(!1),[X,Z]=h.useState(!1),[Q,U]=h.useState(!1),[J,E]=h.useState(""),[W,m]=h.useState("");h.useEffect(()=>{var f,j,F,P,A;d(((f=e.config)==null?void 0:f.canonical)||""),u(((j=e.config)==null?void 0:j.version)||""),p(((P=(F=e.config)==null?void 0:F.fhirVersion)==null?void 0:P.length)>0?e.config.fhirVersion.at(0):""),b(((A=e.config)==null?void 0:A.dependencies)||"")},[e.config]);const S=()=>{o(!0)},g=()=>{o(!1),E("")},I=()=>{a(!0)},T=()=>{a(!1),e.onConfigChange({canonical:c,version:i,fhirVersion:[l],dependencies:C,isGoFSHIndented:w})},D=f=>{const j=f.target.value;d(j)},G=f=>{const j=f.target.value;u(j)},Y=f=>{const j=f.target.value;p(j)},ie=f=>{const j=f.target.value;b(j)},re=f=>{const j=f.target.checked;y(j)},ae=f=>{const j=f.target.checked;e.setIsLineWrapped(j)},le=f=>{const j=f.target.checked;e.setIsDebugConsoleChecked(j)};async function ce(){if(e.isWaiting)return;e.resetLogMessages(),e.onSUSHIClick(!0,[""],!0),L(!0);const f=ht(C),j={canonical:c||"http://example.org",version:i||"1.0.0",FSHOnly:!0,fhirVersion:l?[l]:["4.0.1"]},F=await Dn(e.fshText,j,f,e.isDebugConsoleChecked?"debug":"info");let P=JSON.stringify(F,Ln,2);F&&F.codeSystems?!F.codeSystems.length&&!F.extensions.length&&!F.instances.length&&!F.profiles.length&&!F.logicals.length&&!F.resources.length&&!F.valueSets.length&&(P=[""]):P=[""],e.onSUSHIClick(!0,P,!1),L(!1)}async function de(){if(e.isWaiting)return;e.resetLogMessages(),e.onGoFSHClick("",!0),Z(!0);const f=e.gofshText.map(z=>z.def).filter(z=>z),j=C===""?[]:C.split(",");if(c||i||l!==""){const z={resourceType:"ImplementationGuide",fhirVersion:l?[l]:["4.0.1"],id:"1",...c&&{url:`${c}/ImplementationGuide/1`},...i&&{version:i}};f.push(JSON.stringify(z,null,2))}const F={dependencies:j,indent:w},{fsh:P,config:A}=await Nn(f,F,e.isDebugConsoleChecked?"debug":"info");e.onGoFSHClick(P,!1),Z(!1),c===""&&A.canonical&&d(A.canonical),i===""&&A.version&&u(A.version),l===""&&A.fhirVersion&&p(A.fhirVersion.at(0))}async function ue(f,j){if(!j.endsWith(".fsh"))return;const F=e.exampleMetadata[j];U(!0),m(F.name);const P=new TextDecoder("utf-8");let A=await fetch(F.path).then(x=>x.body.getReader()),z="";const{value:Ne}=await A.read();z+=P.decode(Ne),U(!1),E(z)}function he(f){E(f)}function xe(){navigator.clipboard.writeText(J)}const me=f=>t.jsx(je,{title:e.exampleMetadata[f.id]&&e.exampleMetadata[f.id].description?e.exampleMetadata[f.id].description:f.name,placement:"bottom",arrow:!0,children:t.jsx(Qe,{nodeId:f.id,label:f.name,className:n.treeItem},f.id)},f.id),ke=f=>t.jsx(Qe,{nodeId:f.id,label:f.name,children:f.children?f.children.map(j=>j.children?ke(j):me(j)):null},f.id);return t.jsxs(M,{className:n.box,children:[t.jsx("div",{className:n.leftControls,children:t.jsxs(N,{name:"Examples",className:n.button,onClick:S,children:[t.jsx(Mt,{}),"   FSH Examples"]})}),t.jsxs(q,{container:!0,children:[t.jsx(q,{item:!0,xs:5,children:t.jsxs(N,{className:_(n.button,n.buttonLeft),onClick:ce,testid:"Button",children:["Convert to JSON",O?t.jsx("div",{className:n.progressContainer,children:t.jsx(Ke,{className:n.progress})}):t.jsx(Ze,{className:n.runIcon})]})}),t.jsx(q,{item:!0,xs:7,children:t.jsxs(N,{className:_(n.button,n.buttonRight),onClick:de,testid:"GoFSH-button",children:[X?t.jsx("div",{className:n.progressContainer,children:t.jsx(Ke,{className:n.progress})}):t.jsx(Ze,{className:n.runIcon,style:{transform:"scaleX(-1)"}}),"Convert to FSH"]})})]}),t.jsxs("div",{className:n.rightControls,children:[t.jsxs(N,{name:"SaveAll",className:n.secondaryButton,onClick:e.saveAll,children:[t.jsx(ot,{})," Save All"]}),t.jsxs(N,{name:"Configuration",className:n.secondaryButton,onClick:I,children:[t.jsx(Pt,{})," Configuration"]})]}),t.jsxs(pe,{open:r,onClose:T,"aria-labelledby":"form-dialog-title",children:[t.jsx(fe,{id:"form-dialog-title",children:"Configuration Settings"}),t.jsxs(se,{children:[t.jsx(Te,{children:"Change the Implementation Guide configuration to use when processing FSH and FHIR JSON"}),t.jsx(ye,{id:"canonical",margin:"dense",fullWidth:!0,label:"Canonical URL",helperText:"Default: http://example.org",defaultValue:c,onChange:D}),t.jsx(ye,{id:"version",margin:"dense",fullWidth:!0,label:"Version",helperText:"Default: 1.0.0",defaultValue:i,onChange:G}),t.jsxs(ye,{id:"fhir-version-select",margin:"dense",fullWidth:!0,select:!0,label:"FHIR Version",helperText:"Default: 4.0.1 (R4)",value:l,onChange:Y,children:[t.jsx(He,{value:"4.0.1",children:"4.0.1 (R4)"}),t.jsx(He,{value:"4.3.0",children:"4.3.0 (R4B)"}),t.jsx(He,{value:"5.0.0",children:"5.0.0 (R5)"})]}),t.jsx(ye,{id:"dependencies",margin:"dense",fullWidth:!0,label:"Dependencies",helperText:"Format: packageId#version, packageId#version (e.g., hl7.fhir.us.core#6.0.0)",defaultValue:C,onChange:ie}),t.jsx($e,{id:"goFSHIndent",margin:"dense",control:t.jsx(Ee,{checked:w,color:"primary"}),label:"Indent output of Convert to FSH",onChange:re}),t.jsx(Re,{children:"If set, Convert to FSH will output FSH using path rules"}),t.jsx($e,{id:"lineWrap",margin:"dense",control:t.jsx(Ee,{checked:e.isLineWrapped,color:"primary"}),label:"Line wrap within code editors",onChange:ae}),t.jsx(Re,{children:"If set, FSH Online will display code with line wrapping"}),t.jsx($e,{id:"debugLevelConsole",margin:"dense",control:t.jsx(Ee,{checked:e.isDebugConsoleChecked,color:"primary"}),label:"Debug level console messages",onChange:le}),t.jsx(Re,{children:"If set, FSH Online will display debug level messages within the console"})]}),t.jsx(ge,{children:t.jsx(N,{onClick:T,color:"primary",children:"Done"})})]}),t.jsxs(pe,{open:s,onClose:g,"aria-labelledby":"form-dialog-title",maxWidth:"lg",fullWidth:!0,scroll:"paper",classes:{paper:n.dialogPaper},children:[t.jsx(fe,{id:"form-dialog-title",children:"FSH Examples"}),t.jsx(se,{children:t.jsxs(q,{container:!0,style:{overflow:"scroll",minHeight:"64vh"},children:[t.jsx(q,{item:!0,xs:4,children:t.jsx(Bt,{className:n.treeView,defaultCollapseIcon:t.jsx(rt,{}),defaultExpandIcon:t.jsx(it,{}),onNodeSelect:ue,children:e.exampleConfig.map(f=>ke(f))})}),t.jsx(q,{item:!0,xs:8,children:t.jsx(Je,{name:J?W:"",isExamples:!0,value:J,initialText:J,updateTextValue:he,mode:"fsh",placeholder:Q?"Fetching example...":"Select an example",isLineWrapped:e.isLineWrapped})})]})}),t.jsxs(ge,{className:n.dialogActions,children:[t.jsxs("div",{className:n.dialogActionsMessage,children:["Have an example that might be bene-fish-al? Seas the day and add to our collection on"," ",t.jsx(st,{href:"https://github.com/FHIR/FSHOnline-Examples#readme",children:"GitHub"}),"!"]}),t.jsxs("div",{children:[t.jsxs(N,{onClick:xe,color:"primary",children:[t.jsx(Vt,{})," Copy to clipboard"]}),t.jsx(N,{onClick:g,color:"secondary",children:"Close"})]})]})]})]})}const Gn=oe(()=>({container:{height:"100%",flexGrow:1},fullHeightGrid:{height:"100%"},editorPane:{flexGrow:"0"},resize:{height:"100%",width:"4px",cursor:"col-resize","&:hover":{background:Ue.palette.common.lightBlue}},resizeBlue:{background:"#487AA2"},resizeCursor:{cursor:"col-resize"},collapsedMain:{width:"100%",height:"calc(100vh - 116px - 300px)"},expandedMain:{width:"100%",height:"calc(100vh - 116px - 34px)"},collapsedConsole:{height:"25px",width:"100%"},expandedConsole:{height:"300px",width:"100%"},top:{height:"116px"}})),xt="https://raw.githubusercontent.com/FHIR/FSHOnline-Examples/main",ze="There are no messages to display in the console.",_e="There are no problems to display in the console.";let be=[ze],we=[_e],Pe=0,Be="#FDD835",mt={};console._stdout={};console.log=console._stdout.write=function(n){n&&(n.startsWith("error")||n.startsWith("warn"))&&(we[0]===_e&&(we=[]),Pe++,we.push(n),n.startsWith("error")&&(Be="#FD6668")),be[0]===ze&&(be=[]),be.push(n)};function St(e){e.forEach(n=>{n.type==="category"&&St(n.children),n.id=n.path.replaceAll("%20","-"),n.type==="file"&&(mt[n.id]={path:`${xt}/Examples/${n.path}`,description:n.description,name:n.name}),delete n.type,delete n.path})}async function An(){let e=await fetch(`${xt}/index.json`).then(n=>n.json());return St(e.children),[...e.children]}async function Mn(e){var n,s;if(e===void 0)return"";{const r=(s=(n=(await Qt(e)).long_url)==null?void 0:n.match(/^https?:\/\/(fshonline\.fshschool\.org|fshschool\.org\/FSHOnline)\/#\/share\/(.*)/))==null?void 0:s[2];return!r||r===""?"":We.inflateSync(_t.from(r,"base64")).toString("utf-8")}}async function Pn(e){const n=await fetch(`https://api.github.com/gists/${e}`).then(o=>o.json());let s="";for(let o of Object.values((n==null?void 0:n.files)||{}))o.truncated?s+=await fetch(o.raw_url).then(r=>r.text()):s+=o.content,s+=`

`;return s.trim()}const yt=h.createContext(!1);function Le(e){const n=Gn(),s=Ut(),[o,r]=h.useState(!1),[a,c]=h.useState(""),[d,i]=h.useState([""]),[u,l]=h.useState(""),[p,C]=h.useState(!1),[b,w]=h.useState(!1),[y,O]=h.useState(!1),[L,X]=h.useState([]),[Z,Q]=h.useState({}),[U,J]=h.useState(41.666667),[E,W]=h.useState(!1),[m,S]=h.useState({canonical:"",version:"",fhirVersion:[],dependencies:""}),[g,I]=h.useState({}),[T,D]=h.useState(!1),[G,Y]=h.useState(!1);h.useEffect(()=>{async function x(){if(e.path==="share"){const $=await Mn(s.id),K=$.indexOf(`
`),R=$.slice(0,K);let B,ee=$;try{const V=JSON.parse(R);V.c!=null&&V.v!=null&&V.d!=null&&(B={canonical:V.c,version:V.v,fhirVersion:V.f||[],dependencies:V.d},ee=$.slice(K+1))}catch{}I(B||{}),l(ee)}else if(e.path==="gist"){const $=await Pn(s.id);l($)}}async function k(){X(await An()),Q(mt)}x(),k()},[s,e.path]);function ie(){be=[ze],we=[_e],Pe=0,Be="#FDD835"}function re(x,k,$){r(x),i(k),C($)}function ae(x,k){w(k),l(x===""?null:x)}function le(x){(u===""||u===null)&&l(x),c(x)}function ce(x){i(x)}function de(x){S(x)}function ue(){J(41.666667)}function he(x){x.preventDefault(),W(!0)}function xe(x){x.preventDefault(),W(!1)}function me(){W(!0)}function ke(){W(!1)}function f(x){D(x)}function j(x){Y(x)}function F(x){if(E){const k=x/window.innerWidth*100;k>10&&k<76&&J(k)}}function P(x){const k=x.clientX;E&&v.debounce(()=>F(k),10)()}function A(x){const k=x.touches[0].clientX;E&&v.debounce(()=>F(k),10)()}function z(x,k){if(k.get(x)){let $=k.get(x),K=`${x}-${$}`;for(;k.get(K);)$=$+1,K=`${x}-${$}`;k.set(x,$+1),x=K,k.set(K,1)}else k.set(x,1);return x}function Ne(){const x=new Map,k=new zt;k.file("FSH.fsh",a);const[$,K]=v.partition(d,R=>R.id&&R.id!=="Untitled");$.forEach(R=>{let B;try{B=JSON.parse(R.def)}catch{}const ee=z(B!=null&&B.resourceType?`${B.resourceType}-${R.id}`:R.id,x),V=R.def??null;k.file(`${ee}.json`,V)}),K.forEach(R=>{let B;try{B=JSON.parse(R.def)}catch{}const ee=R.id??"Untitled",V=z(B.resourceType?`${B.resourceType}-${ee}`:ee,x),Ct=R.def??null;k.file(`${V}.json`,Ct)}),k.generateAsync({type:"blob"}).then(R=>{Ve.saveAs(R,"fshonline.zip")})}return t.jsx(Jt,{theme:Ue,children:t.jsxs("div",{className:"root",style:{height:"100vh"},children:[t.jsxs("div",{className:n.top,children:[t.jsx(nn,{}),t.jsx(Wn,{onSUSHIClick:re,onGoFSHClick:ae,onConfigChange:de,config:g,fshText:a,gofshText:d,resetLogMessages:ie,exampleConfig:L,exampleMetadata:Z,isWaiting:b||p,saveAll:Ne,setIsLineWrapped:f,isLineWrapped:T,setIsDebugConsoleChecked:j,isDebugConsoleChecked:G})]}),t.jsx("div",{className:y?n.collapsedMain:n.expandedMain,children:t.jsx(yt.Provider,{value:y,children:t.jsxs(q,{className:_(n.container,E&&n.resizeCursor),container:!0,onTouchMove:A,onMouseMove:P,onMouseUp:xe,onMouseLeave:xe,children:[t.jsx(q,{item:!0,className:_(n.fullHeightGrid,n.editorPane),style:{maxWidth:`calc(${U}% - 2px)`,flexBasis:`calc(${U}% - 2px)`},children:t.jsx(dn,{text:a,initialText:u,updateTextValue:le,isWaiting:b,setInitialText:l,config:m,isLineWrapped:T})}),t.jsx(q,{item:!0,className:_(n.resize,E&&n.resizeBlue),onTouchStart:me,onTouchEnd:ke,onMouseDown:he,onDoubleClick:ue}),t.jsx(q,{item:!0,className:_(n.fullHeightGrid,n.editorPane),style:{maxWidth:`calc(${100-U}% - 2px)`,flexBasis:`calc(${100-U}% - 2px)`},children:t.jsx(cn,{text:d,showNewText:o,setShowNewText:r,isWaiting:p,updateTextValue:ce,isLineWrapped:T})})]})})}),t.jsx("div",{className:y?n.expandedConsole:n.collapsedConsole,children:t.jsx(hn,{consoleMessages:be,problemMessages:we,problemCount:Pe,problemColor:Be,expandConsole:y,setExpandConsole:O})})]})})}function Bn(){return t.jsxs(qt,{children:[t.jsx(Oe,{path:"/share/:id",element:t.jsx(Le,{path:"share"})}),t.jsx(Oe,{path:"/gist/:id",element:t.jsx(Le,{path:"gist"})}),t.jsx(Oe,{path:"/*",element:t.jsx(Le,{})})]})}Xt.render(t.jsx(Yt.StrictMode,{children:t.jsx(Kt,{basename:"/",children:t.jsx(Bn,{})})}),document.getElementById("root"));
